<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>FileNest - Your Personal File Cache</title>
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üóÑÔ∏è</text></svg>"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/icon?family=Material+Icons"
            rel="stylesheet"
        />
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            :root {
                --primary-color: #3f51b5;
                --primary-light: #7986cb;
                --primary-dark: #303f9f;
                --secondary-color: #ff4081;
                --secondary-light: #ff79b0;
                --secondary-dark: #c60055;
                --success-color: #4caf50;
                --error-color: #f44336;
                --warning-color: #ff9800;
                --info-color: #2196f3;
                --surface-color: #ffffff;
                --background-color: #fafafa;
                --on-surface: #212121;
                --on-primary: #ffffff;
                --on-secondary: #ffffff;
                --gray-50: #fafafa;
                --gray-100: #f5f5f5;
                --gray-200: #eeeeee;
                --gray-300: #e0e0e0;
                --gray-400: #bdbdbd;
                --gray-500: #9e9e9e;
                --gray-600: #757575;
                --gray-700: #616161;
                --gray-800: #424242;
                --gray-900: #212121;
                --elevation-1:
                    0 2px 1px -1px rgba(0, 0, 0, 0.2),
                    0 1px 1px 0 rgba(0, 0, 0, 0.14),
                    0 1px 3px 0 rgba(0, 0, 0, 0.12);
                --elevation-2:
                    0 3px 1px -2px rgba(0, 0, 0, 0.2),
                    0 2px 2px 0 rgba(0, 0, 0, 0.14),
                    0 1px 5px 0 rgba(0, 0, 0, 0.12);
                --elevation-4:
                    0 2px 4px -1px rgba(0, 0, 0, 0.2),
                    0 4px 5px 0 rgba(0, 0, 0, 0.14),
                    0 1px 10px 0 rgba(0, 0, 0, 0.12);
                --elevation-8:
                    0 5px 5px -3px rgba(0, 0, 0, 0.2),
                    0 8px 10px 1px rgba(0, 0, 0, 0.14),
                    0 3px 14px 2px rgba(0, 0, 0, 0.12);
                --elevation-16:
                    0 8px 10px -5px rgba(0, 0, 0, 0.2),
                    0 16px 24px 2px rgba(0, 0, 0, 0.14),
                    0 6px 30px 5px rgba(0, 0, 0, 0.12);
                --border-radius: 4px;
                --border-radius-large: 16px;
                --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
                --transition-standard: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            }

            body {
                font-family:
                    "Roboto",
                    -apple-system,
                    BlinkMacSystemFont,
                    sans-serif;
                background: linear-gradient(
                    135deg,
                    var(--primary-color) 0%,
                    var(--primary-light) 50%,
                    var(--secondary-color) 100%
                );
                background-attachment: fixed;
                min-height: 100vh;
                color: var(--on-surface);
                line-height: 1.6;
                overflow-x: hidden;
                padding-top: 120px;
            }

            .background-decoration {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: -1;
                opacity: 0.1;
            }

            .floating-shapes {
                position: absolute;
                width: 100%;
                height: 100%;
            }

            .shape {
                position: absolute;
                background: linear-gradient(
                    45deg,
                    var(--primary-light),
                    var(--secondary-light)
                );
                border-radius: 50%;
                animation: float 20s infinite linear;
            }

            .shape:nth-child(1) {
                width: 80px;
                height: 80px;
                top: 20%;
                left: 10%;
                animation-delay: 0s;
            }

            .shape:nth-child(2) {
                width: 120px;
                height: 120px;
                top: 60%;
                left: 80%;
                animation-delay: -7s;
            }

            .shape:nth-child(3) {
                width: 60px;
                height: 60px;
                top: 80%;
                left: 20%;
                animation-delay: -12s;
            }

            .shape:nth-child(4) {
                width: 100px;
                height: 100px;
                top: 10%;
                left: 70%;
                animation-delay: -5s;
            }

            @keyframes float {
                0%,
                100% {
                    transform: translateY(0px) rotate(0deg);
                }
                25% {
                    transform: translateY(-20px) rotate(90deg);
                }
                50% {
                    transform: translateY(-40px) rotate(180deg);
                }
                75% {
                    transform: translateY(-20px) rotate(270deg);
                }
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 1rem;
                position: relative;
                z-index: 1;
            }

            .main-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 1rem;
                position: relative;
                z-index: 1;
                margin-top: 2rem;
            }

            .header {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                color: var(--on-primary);
                padding: 1rem 0;
                background: rgba(102, 126, 234, 0.95);
                backdrop-filter: blur(20px) saturate(180%);
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
                z-index: 1000;
                animation: slideInDown var(--transition-slow) ease-out;
                transition: all var(--transition-standard);
            }

            .header-content {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 1rem;
                display: flex;
                align-items: center;
                justify-content: center;
                text-align: center;
                position: relative;
            }

            .header-user-info {
                position: absolute;
                right: 0;
                display: flex;
                align-items: center;
                color: var(--on-primary);
                font-weight: 500;
                opacity: 0;
                transform: translateX(20px);
                transition: all var(--transition-standard);
            }

            .header-user-info.show {
                opacity: 1;
                transform: translateX(0);
            }

            #headerText {
                opacity: 1;
                transition: all var(--transition-standard);
            }

            #headerText.hide {
                opacity: 0;
                transform: scale(0.95);
            }

            .header:hover {
                background: rgba(102, 126, 234, 0.98);
                transform: translateY(-1px);
                box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            }

            .header h1 {
                font-size: 3.5rem;
                margin-bottom: 1rem;
                font-weight: 300;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
                animation: fadeInScale var(--transition-slow) ease-out 0.2s both;
            }

            .header .logo-icon {
                width: 80px;
                height: 80px;
                border-radius: 50%;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
                border: 4px solid rgba(255, 255, 255, 0.8);
                transition: all var(--transition-standard);
                filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
                margin-bottom: 1rem;
                display: inline-block;
                animation: bounce 2s infinite;
                object-fit: contain;
            }

            .header p {
                font-size: 1.25rem;
                opacity: 0.9;
                max-width: 600px;
                margin: 0 auto;
                font-weight: 300;
                animation: fadeInUp var(--transition-slow) ease-out 0.4s both;
            }

            @keyframes slideInDown {
                from {
                    transform: translateY(-100px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            @keyframes fadeInScale {
                from {
                    transform: scale(0.8);
                    opacity: 0;
                }
                to {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            @keyframes fadeInUp {
                from {
                    transform: translateY(30px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            @keyframes bounce {
                0%,
                20%,
                50%,
                80%,
                100% {
                    transform: translateY(0);
                }
                40% {
                    transform: translateY(-10px);
                }
                60% {
                    transform: translateY(-5px);
                }
            }

            .main-content {
                background: var(--surface-color);
                border-radius: var(--border-radius-large);
                box-shadow: var(--elevation-8);
                overflow: hidden;
                backdrop-filter: blur(10px);
                animation: fadeInUp var(--transition-slow) ease-out 0.6s both;
                position: relative;
            }

            .main-content::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(
                    90deg,
                    var(--primary-color),
                    var(--secondary-color)
                );
            }

            .auth-section {
                padding: 2rem;
                background: var(--surface-color);
                min-height: 500px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            .auth-tabs {
                display: flex;
                margin-bottom: 2rem;
                background: var(--gray-100);
                border-radius: var(--border-radius);
                padding: 4px;
                position: relative;
                overflow: hidden;
            }

            .auth-tab {
                flex: 1;
                padding: 1rem;
                text-align: center;
                cursor: pointer;
                border: none;
                background: transparent;
                font-size: 1rem;
                font-weight: 500;
                color: var(--gray-600);
                border-radius: var(--border-radius);
                transition: all var(--transition-standard);
                position: relative;
                z-index: 2;
            }

            .auth-tab.active {
                color: var(--on-primary);
                background: var(--primary-color);
                box-shadow: var(--elevation-2);
                transform: translateY(-1px);
            }

            .auth-form {
                display: none;
                opacity: 0;
                transform: translateY(20px);
                transition: all var(--transition-standard);
            }

            .auth-form.active {
                display: block;
                opacity: 1;
                transform: translateY(0);
                animation: slideInForm var(--transition-standard) ease-out;
            }

            @keyframes slideInForm {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .auth-form h2 {
                font-size: 1.5rem;
                margin-bottom: 1.5rem;
                color: var(--gray-800);
                font-weight: 400;
                text-align: center;
            }

            .form-group {
                margin-bottom: 1.5rem;
                position: relative;
            }

            .form-group label {
                display: block;
                margin-bottom: 0.5rem;
                color: var(--gray-700);
                font-weight: 500;
                font-size: 0.875rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .form-group input {
                width: 100%;
                padding: 1rem;
                border: 2px solid var(--gray-300);
                border-radius: var(--border-radius);
                font-size: 1rem;
                transition: all var(--transition-fast);
                background: var(--surface-color);
                position: relative;
            }

            .form-group input:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.1);
                transform: translateY(-1px);
            }

            .form-group input::placeholder {
                color: var(--gray-400);
                transition: opacity var(--transition-fast);
            }

            .form-group input:focus::placeholder {
                opacity: 0.7;
            }

            .form-group input:invalid {
                border-color: var(--error-color);
            }

            .material-input {
                position: relative;
                margin-bottom: 1.5rem;
            }

            .material-input input {
                width: 100%;
                padding: 1rem 1rem 0.5rem;
                border: none;
                border-bottom: 2px solid var(--gray-300);
                background: transparent;
                font-size: 1rem;
                transition: all var(--transition-fast);
            }

            .material-input label {
                position: absolute;
                top: 1rem;
                left: 1rem;
                color: var(--gray-500);
                font-size: 1rem;
                pointer-events: none;
                transition: all var(--transition-fast);
                transform-origin: left;
            }

            .material-input input:focus + label,
            .material-input input:not(:placeholder-shown) + label {
                transform: translateY(-0.75rem) scale(0.75);
                color: var(--primary-color);
            }

            .material-input input:focus {
                outline: none;
                border-bottom-color: var(--primary-color);
            }

            .btn {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                padding: 0.75rem 2rem;
                background: var(--primary-color);
                color: var(--on-primary);
                border: none;
                border-radius: var(--border-radius);
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                transition: all var(--transition-fast);
                text-decoration: none;
                position: relative;
                overflow: hidden;
                box-shadow: var(--elevation-2);
                text-transform: uppercase;
                letter-spacing: 0.5px;
                min-width: 120px;
            }

            .btn::before {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                transform: translate(-50%, -50%);
                transition:
                    width 0.6s,
                    height 0.6s;
            }

            .btn:hover:not(:disabled) {
                background: var(--primary-dark);
                box-shadow: var(--elevation-4);
                transform: translateY(-2px);
            }

            .btn:hover:not(:disabled)::before {
                width: 300px;
                height: 300px;
            }

            .btn:active {
                transform: translateY(0);
                box-shadow: var(--elevation-2);
            }

            .btn:disabled {
                background: var(--gray-300);
                color: var(--gray-500);
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }

            .btn-fab {
                width: 56px;
                height: 56px;
                min-width: 56px;
                min-height: 56px;
                border-radius: 50% !important;
                padding: 0 !important;
                font-size: 1.5rem;
                box-shadow: var(--elevation-4);
                position: fixed;
                bottom: 2rem;
                right: 2rem;
                z-index: 10;
                display: flex !important;
                align-items: center;
                justify-content: center;
                overflow: hidden;
            }

            .btn-fab:hover {
                box-shadow: var(--elevation-8);
                transform: scale(1.1);
            }

            .btn-fab .material-icons {
                font-size: 24px;
                line-height: 1;
            }

            .btn-secondary {
                background: var(--gray-200);
                color: var(--gray-800);
            }

            .btn-secondary:hover:not(:disabled) {
                background: var(--gray-300);
            }

            .btn-danger {
                background: var(--error-color);
                color: var(--on-primary);
            }

            .btn-danger:hover:not(:disabled) {
                background: #d32f2f;
            }

            .btn-small {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
                min-width: auto;
            }

            .app-section {
                display: none;
                padding: 0;
            }

            .app-section.active {
                display: block;
                animation: fadeInSpin var(--transition-standard) ease-out;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }

            @keyframes fadeInSpin {
                from {
                    opacity: 0;
                    transform: rotate(-180deg) scale(0.8);
                }
                to {
                    opacity: 1;
                    transform: rotate(0deg) scale(1);
                }
            }

            @keyframes fadeInSpinChild {
                from {
                    opacity: 0;
                    transform: translateY(30px) rotate(-90deg) scale(0.9);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) rotate(0deg) scale(1);
                }
            }

            .user-info {
                background: linear-gradient(
                    135deg,
                    var(--primary-color),
                    var(--primary-light)
                );
                color: var(--on-primary);
                padding: 2rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: relative;
                overflow: hidden;
                opacity: 0;
                transform: translateY(30px) rotate(-90deg) scale(0.9);
            }

            .user-info::before {
                content: "";
                position: absolute;
                top: -50%;
                right: -50%;
                width: 200%;
                height: 200%;
                background: radial-gradient(
                    circle,
                    rgba(255, 255, 255, 0.1) 0%,
                    transparent 70%
                );
                animation: rotate 20s linear infinite;
            }

            @keyframes rotate {
                from {
                    transform: rotate(0deg);
                }
                to {
                    transform: rotate(360deg);
                }
            }

            .user-details {
                position: relative;
                z-index: 2;
            }

            .user-details h3 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
                font-weight: 400;
            }

            .user-details p {
                opacity: 0.9;
                font-size: 1rem;
            }

            .upload-section {
                padding: 2rem;
                background: var(--surface-color);
                opacity: 0;
                transform: translateY(30px) rotate(-90deg) scale(0.9);
            }

            .upload-section h2 {
                font-size: 1.75rem;
                margin-bottom: 0.5rem;
                color: var(--gray-800);
                font-weight: 400;
            }

            .upload-section p {
                color: var(--gray-600);
                margin-bottom: 2rem;
            }

            .upload-area {
                border: 2px dashed var(--gray-300);
                border-radius: var(--border-radius-large);
                padding: 3rem 2rem;
                text-align: center;
                cursor: pointer;
                transition: all var(--transition-standard);
                background: var(--gray-50);
                position: relative;
                overflow: hidden;
            }

            .upload-area::before {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                background: radial-gradient(
                    circle,
                    var(--primary-color) 0%,
                    transparent 70%
                );
                opacity: 0;
                transform: translate(-50%, -50%);
                transition: all var(--transition-standard);
                border-radius: 50%;
            }

            .upload-area:hover {
                border-color: var(--primary-color);
                background: rgba(63, 81, 181, 0.05);
                transform: translateY(-2px);
                box-shadow: var(--elevation-4);
            }

            .upload-area:hover::before {
                width: 100px;
                height: 100px;
                opacity: 0.1;
            }

            .upload-area.dragover {
                border-color: var(--primary-color);
                background: rgba(63, 81, 181, 0.1);
                transform: scale(1.02);
            }

            .upload-icon {
                font-size: 3rem;
                color: var(--primary-color);
                margin-bottom: 1rem;
                display: block;
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }

            .upload-text {
                font-size: 1.25rem;
                color: var(--gray-700);
                margin-bottom: 0.5rem;
                font-weight: 500;
            }

            .upload-subtext {
                color: var(--gray-500);
                font-size: 0.875rem;
            }

            .file-input {
                display: none;
            }

            .stats {
                background: var(--gray-50);
                padding: 2rem;
                border-top: 1px solid var(--gray-200);
                opacity: 0;
                transform: translateY(30px) rotate(-90deg) scale(0.9);
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1.5rem;
            }

            .stat-item {
                text-align: center;
                padding: 1.5rem;
                background: var(--surface-color);
                border-radius: var(--border-radius);
                box-shadow: var(--elevation-1);
                transition: all var(--transition-standard);
                position: relative;
                overflow: hidden;
            }

            .stat-item::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 3px;
                background: linear-gradient(
                    90deg,
                    var(--primary-color),
                    var(--secondary-color)
                );
            }

            .stat-item:hover {
                transform: translateY(-4px);
                box-shadow: var(--elevation-4);
            }

            .stat-value {
                font-size: 2rem;
                font-weight: 700;
                color: var(--primary-color);
                margin-bottom: 0.5rem;
                animation: countUp 1s ease-out;
            }

            @keyframes countUp {
                from {
                    transform: scale(0);
                }
                to {
                    transform: scale(1);
                }
            }

            .stat-label {
                color: var(--gray-600);
                font-size: 0.875rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-weight: 500;
            }

            .files-section {
                padding: 2rem;
                background: var(--surface-color);
                opacity: 0;
                transform: translateY(30px) rotate(-90deg) scale(0.9);
            }

            .files-section h2 {
                font-size: 1.75rem;
                margin-bottom: 1.5rem;
                color: var(--gray-800);
                font-weight: 400;
            }

            .files-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 1.5rem;
            }

            .file-card {
                background: var(--surface-color);
                border-radius: var(--border-radius);
                box-shadow: var(--elevation-2);
                transition: all var(--transition-standard);
                overflow: hidden;
                position: relative;
                border: 1px solid var(--gray-200);
            }

            .file-card:hover {
                box-shadow: var(--elevation-8);
                transform: translateY(-4px);
            }

            .file-card::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(
                    45deg,
                    transparent 0%,
                    rgba(63, 81, 181, 0.05) 100%
                );
                opacity: 0;
                transition: opacity var(--transition-standard);
            }

            .file-card:hover::before {
                opacity: 1;
            }

            .file-info {
                padding: 1.5rem;
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .file-icon {
                width: 48px;
                height: 48px;
                background: var(--primary-color);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--on-primary);
                font-size: 1.5rem;
                flex-shrink: 0;
                position: relative;
                overflow: hidden;
            }

            .file-icon::before {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                transform: translate(-50%, -50%);
                transition: all 0.6s ease;
            }

            .file-card:hover .file-icon::before {
                width: 100px;
                height: 100px;
            }

            .file-details {
                flex: 1;
                min-width: 0;
            }

            .file-details h3 {
                font-size: 1rem;
                font-weight: 500;
                color: var(--gray-800);
                margin-bottom: 0.25rem;
                word-break: break-word;
                line-height: 1.4;
            }

            .file-meta {
                display: flex;
                gap: 1rem;
                color: var(--gray-500);
                font-size: 0.75rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .file-meta span {
                display: flex;
                align-items: center;
                gap: 0.25rem;
            }

            .file-actions {
                padding: 0 1.5rem 1.5rem;
                display: flex;
                gap: 0.5rem;
            }

            .file-actions .btn {
                flex: 1;
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }

            .alerts-container {
                position: fixed;
                top: 2rem;
                right: 2rem;
                z-index: 1000;
                max-width: 400px;
            }

            .alert {
                padding: 1rem 1.5rem;
                margin-bottom: 1rem;
                border-radius: var(--border-radius);
                box-shadow: var(--elevation-4);
                display: flex;
                align-items: center;
                justify-content: space-between;
                animation: slideInRight var(--transition-standard) ease-out;
                position: relative;
                overflow: hidden;
            }

            .alert::before {
                content: "";
                position: absolute;
                left: 0;
                top: 0;
                width: 4px;
                height: 100%;
                background: currentColor;
            }

            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            .alert-success {
                background: #e8f5e8;
                color: var(--success-color);
                border: 1px solid #c8e6c9;
            }

            .alert-error {
                background: #ffebee;
                color: var(--error-color);
                border: 1px solid #ffcdd2;
            }

            .alert-close {
                background: none;
                border: none;
                font-size: 1.25rem;
                cursor: pointer;
                color: inherit;
                opacity: 0.7;
                transition: opacity var(--transition-fast);
                width: 24px;
                height: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
            }

            .alert-close:hover {
                opacity: 1;
                background: rgba(0, 0, 0, 0.1);
            }

            .loading {
                display: none;
                text-align: center;
                padding: 2rem;
                color: var(--gray-600);
            }

            .spinner {
                display: inline-block;
                width: 40px;
                height: 40px;
                border: 4px solid var(--gray-200);
                border-radius: 50%;
                border-top-color: var(--primary-color);
                animation: spin 1s ease-in-out infinite;
                margin-bottom: 1rem;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .ripple {
                position: absolute;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.6);
                transform: scale(0);
                animation: ripple-animation 0.6s linear;
                pointer-events: none;
            }

            @keyframes ripple-animation {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }

            .hidden {
                display: none !important;
            }

            .empty-state {
                text-align: center;
                padding: 3rem 2rem;
                color: var(--gray-500);
            }

            .empty-state-icon {
                font-size: 4rem;
                margin-bottom: 1rem;
                opacity: 0.5;
            }

            .empty-state h3 {
                font-size: 1.25rem;
                margin-bottom: 0.5rem;
                color: var(--gray-600);
            }

            .progress-bar {
                width: 100%;
                height: 8px;
                background: var(--gray-200);
                border-radius: 4px;
                overflow: hidden;
                margin: 1rem 0;
                position: relative;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(
                    90deg,
                    var(--primary-color),
                    var(--secondary-color)
                );
                border-radius: 4px;
                transition: width var(--transition-standard);
                position: relative;
                overflow: hidden;
            }

            .progress-fill::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.4),
                    transparent
                );
                animation: shimmer 2s infinite;
            }

            @keyframes shimmer {
                0% {
                    transform: translateX(-100%);
                }
                100% {
                    transform: translateX(100%);
                }
            }

            .progress-text {
                text-align: center;
                margin-top: 0.5rem;
                font-size: 0.875rem;
                color: var(--gray-600);
                font-weight: 500;
            }

            .upload-status {
                margin-top: 0.5rem;
                font-size: 0.875rem;
                color: var(--gray-600);
                text-align: center;
            }

            /* Preview Modal */
            .preview-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                backdrop-filter: blur(5px);
                animation: fadeIn var(--transition-standard) ease-out;
            }

            .preview-modal.active {
                display: flex;
            }

            .preview-content {
                position: relative;
                max-width: 90%;
                max-height: 90%;
                background: var(--surface-color);
                border-radius: var(--border-radius-large);
                box-shadow: var(--elevation-16);
                overflow: hidden;
                animation: scaleIn var(--transition-standard) ease-out;
            }

            @keyframes scaleIn {
                from {
                    transform: scale(0.8);
                    opacity: 0;
                }
                to {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            .preview-header {
                padding: 1rem 1.5rem;
                background: var(--primary-color);
                color: var(--on-primary);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .preview-title {
                font-size: 1.125rem;
                font-weight: 500;
                margin: 0;
                word-break: break-word;
            }

            .preview-close {
                background: none;
                border: none;
                color: var(--on-primary);
                font-size: 1.5rem;
                cursor: pointer;
                padding: 0.25rem;
                border-radius: 50%;
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background-color var(--transition-fast);
            }

            .preview-close:hover {
                background: rgba(255, 255, 255, 0.1);
            }

            .preview-body {
                padding: 0;
                max-width: 90vw;
                max-height: 80vh;
                overflow: auto;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .preview-image {
                max-width: 100%;
                max-height: 100%;
                object-fit: contain;
                display: block;
            }

            .preview-text {
                padding: 2rem;
                font-family: "Courier New", monospace;
                font-size: 0.875rem;
                line-height: 1.6;
                color: var(--gray-800);
                white-space: pre-wrap;
                word-wrap: break-word;
                max-width: 800px;
                max-height: 70vh;
                overflow: auto;
            }

            .preview-error {
                padding: 2rem;
                text-align: center;
                color: var(--error-color);
            }

            .preview-loading {
                padding: 3rem;
                text-align: center;
                color: var(--gray-600);
            }

            .preview-loading .spinner {
                margin: 0 auto 1rem;
            }

            /* Rename functionality */
            .file-name-editable {
                background: transparent;
                border: none;
                font-size: inherit;
                font-weight: inherit;
                color: inherit;
                width: 100%;
                padding: 2px 4px;
                border-radius: var(--border-radius);
                transition: all var(--transition-fast);
                outline: none;
            }

            .file-name-editable:focus {
                background: var(--gray-100);
                border: 2px solid var(--primary-color);
                box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.1);
            }

            .file-name-editable:hover {
                background: var(--gray-50);
            }

            .rename-controls {
                display: none;
                gap: 0.25rem;
                margin-top: 0.5rem;
                justify-content: flex-start;
            }

            .rename-controls.active {
                display: flex;
            }

            .rename-controls .btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
                min-width: auto;
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .container,
                .main-container {
                    padding: 1rem;
                }

                .header {
                    padding: 0.75rem 0;
                }

                .header-content {
                    padding: 0 0.5rem;
                    flex-direction: column;
                    gap: 0.5rem;
                }

                .header-user-info {
                    position: static;
                    margin-top: 0.5rem;
                }

                .header .logo-icon {
                    width: 50px;
                    height: 50px;
                }

                .header p {
                    font-size: 0.9rem;
                    margin: 0.5rem 0 0 0;
                }

                body {
                    padding-top: 120px;
                }

                .auth-section,
                .upload-section,
                .files-section {
                    padding: 1.5rem;
                }

                .upload-area {
                    padding: 2rem 1rem;
                }

                .files-grid {
                    grid-template-columns: 1fr;
                }

                .user-info {
                    flex-direction: column;
                    gap: 1rem;
                    text-align: center;
                }

                .file-actions {
                    flex-direction: column;
                }

                .stats-grid {
                    grid-template-columns: repeat(2, 1fr);
                }

                .btn-fab {
                    bottom: 1rem;
                    right: 1rem;
                }
            }

            @media (max-width: 480px) {
                .auth-tabs {
                    flex-direction: column;
                    gap: 0.5rem;
                }

                .auth-tab {
                    width: 100%;
                }

                .file-info {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 0.5rem;
                }

                .file-icon {
                    margin-right: 0;
                }

                .header {
                    padding: 0.5rem 0;
                }

                .header-content {
                    padding: 0 0.5rem;
                }

                .header-user-info {
                    flex-direction: column;
                    align-items: center;
                    gap: 0.25rem;
                }

                .header-user-info .btn {
                    font-size: 0.75rem;
                    padding: 0.25rem 0.5rem;
                    margin-left: 0 !important;
                }

                .header .logo-icon {
                    width: 40px;
                    height: 40px;
                }

                .header p {
                    font-size: 0.8rem;
                }

                body {
                    padding-top: 100px;
                }

                .stats-grid {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    </head>
    <body>
        <div class="background-decoration">
            <div class="floating-shapes">
                <div class="shape"></div>
                <div class="shape"></div>
                <div class="shape"></div>
                <div class="shape"></div>
            </div>
        </div>

        <div class="header" id="mainHeader">
            <div class="header-content">
                <img
                    src="FileNest_Logo.png"
                    alt="FileNest Logo"
                    class="logo-icon"
                />
                <p id="headerText">
                    Your Personal File Cache - Secure, Simple, Fast
                </p>
                <div
                    class="header-user-info"
                    id="headerUserInfo"
                    style="display: none"
                >
                    <button
                        class="btn btn-small btn-secondary"
                        id="headerLogoutBtn"
                        style="margin-left: 1rem"
                    >
                        <span
                            class="material-icons"
                            style="margin-right: 0.25rem; font-size: 1rem"
                            >logout</span
                        >
                        Logout
                    </button>
                </div>
            </div>
        </div>

        <div class="main-container">
            <div class="main-content">
                <!-- Authentication Section -->
                <div class="auth-section" id="authSection">
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="login">
                            <span
                                class="material-icons"
                                style="margin-right: 0.5rem; font-size: 1.2rem"
                                >login</span
                            >
                            Login
                        </button>
                        <button class="auth-tab" data-tab="register">
                            <span
                                class="material-icons"
                                style="margin-right: 0.5rem; font-size: 1.2rem"
                                >person_add</span
                            >
                            Register
                        </button>
                    </div>

                    <!-- Login Form -->
                    <div class="auth-form active" id="loginForm">
                        <h2>Welcome Back</h2>
                        <form id="loginFormElement">
                            <div class="material-input">
                                <input
                                    type="email"
                                    id="loginEmail"
                                    name="email"
                                    required
                                    placeholder=" "
                                />
                                <label for="loginEmail">Email Address</label>
                            </div>
                            <div class="material-input">
                                <input
                                    type="password"
                                    id="loginPassword"
                                    name="password"
                                    required
                                    placeholder=" "
                                />
                                <label for="loginPassword">Password</label>
                            </div>
                            <button type="submit" class="btn" id="loginBtn">
                                <span class="btn-text">Login</span>
                            </button>
                        </form>
                    </div>

                    <!-- Register Form -->
                    <div class="auth-form" id="registerForm">
                        <h2>Create Account</h2>
                        <form id="registerFormElement">
                            <div class="material-input">
                                <input
                                    type="text"
                                    id="registerName"
                                    name="name"
                                    required
                                    placeholder=" "
                                />
                                <label for="registerName">Full Name</label>
                            </div>
                            <div class="material-input">
                                <input
                                    type="email"
                                    id="registerEmail"
                                    name="email"
                                    required
                                    placeholder=" "
                                />
                                <label for="registerEmail">Email Address</label>
                            </div>
                            <div class="material-input">
                                <input
                                    type="password"
                                    id="registerPassword"
                                    name="password"
                                    required
                                    minlength="6"
                                    placeholder=" "
                                />
                                <label for="registerPassword">Password</label>
                            </div>
                            <div class="material-input">
                                <input
                                    type="password"
                                    id="registerPasswordConfirm"
                                    name="password_confirmation"
                                    required
                                    placeholder=" "
                                />
                                <label for="registerPasswordConfirm"
                                    >Confirm Password</label
                                >
                            </div>
                            <button type="submit" class="btn" id="registerBtn">
                                <span class="btn-text">Create Account</span>
                            </button>
                        </form>
                    </div>
                </div>

                <!-- App Section -->
                <div class="app-section" id="appSection">
                    <!-- User Info -->
                    <div class="user-info">
                        <div class="user-details">
                            <h3>Welcome, <span id="userName"></span>! üëã</h3>
                            <p id="userEmail"></p>
                        </div>
                        <button
                            class="btn btn-small btn-secondary"
                            id="logoutBtn"
                        >
                            <span
                                class="material-icons"
                                style="margin-right: 0.25rem; font-size: 1rem"
                                >logout</span
                            >
                            Logout
                        </button>
                    </div>

                    <!-- Upload Section -->
                    <div class="upload-section">
                        <h2>
                            <span
                                class="material-icons"
                                style="
                                    margin-right: 0.5rem;
                                    vertical-align: middle;
                                "
                                >cloud_upload</span
                            >
                            Upload Files
                        </h2>
                        <p>
                            Supported formats: JPG, PNG, GIF, SVG, TXT, MD, CSV
                            ‚Ä¢ Maximum size: 2MB
                        </p>

                        <div class="upload-area" id="uploadArea">
                            <span class="upload-icon material-icons"
                                >cloud_upload</span
                            >
                            <div class="upload-text">
                                Drag & drop files here
                            </div>
                            <div class="upload-subtext">or</div>
                            <button
                                type="button"
                                class="btn"
                                onclick="document.getElementById('fileInput').click()"
                            >
                                <span
                                    class="material-icons"
                                    style="margin-right: 0.5rem"
                                    >folder_open</span
                                >
                                Choose Files
                            </button>
                            <div
                                class="progress-bar hidden"
                                id="uploadProgress"
                            >
                                <div
                                    class="progress-fill"
                                    id="uploadProgressFill"
                                ></div>
                            </div>
                            <div
                                class="progress-text hidden"
                                id="uploadProgressText"
                            >
                                0%
                            </div>
                            <div
                                class="upload-status hidden"
                                id="uploadStatus"
                            ></div>
                        </div>

                        <input
                            type="file"
                            id="fileInput"
                            class="file-input"
                            multiple
                            accept=".jpg,.jpeg,.png,.gif,.svg,.txt,.md,.csv,image/*,text/*"
                        />
                    </div>

                    <!-- Stats Section -->
                    <div class="stats" id="statsSection">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="totalFiles">0</div>
                                <div class="stat-label">
                                    <span
                                        class="material-icons"
                                        style="
                                            margin-right: 0.25rem;
                                            font-size: 1rem;
                                        "
                                        >description</span
                                    >
                                    Files
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalSize">0 B</div>
                                <div class="stat-label">
                                    <span
                                        class="material-icons"
                                        style="
                                            margin-right: 0.25rem;
                                            font-size: 1rem;
                                        "
                                        >storage</span
                                    >
                                    Storage Used
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="imageFiles">0</div>
                                <div class="stat-label">
                                    <span
                                        class="material-icons"
                                        style="
                                            margin-right: 0.25rem;
                                            font-size: 1rem;
                                        "
                                        >image</span
                                    >
                                    Images
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="documentFiles">
                                    0
                                </div>
                                <div class="stat-label">
                                    <span
                                        class="material-icons"
                                        style="
                                            margin-right: 0.25rem;
                                            font-size: 1rem;
                                        "
                                        >article</span
                                    >
                                    Documents
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Files Section -->
                    <div class="files-section">
                        <h2>
                            <span
                                class="material-icons"
                                style="
                                    margin-right: 0.5rem;
                                    vertical-align: middle;
                                "
                                >folder</span
                            >
                            Your Files
                        </h2>
                        <div id="loadingFiles" class="loading hidden">
                            <div class="spinner"></div>
                            <p>Loading your files...</p>
                        </div>
                        <div class="files-grid" id="filesGrid">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <span
                                        class="material-icons"
                                        style="font-size: 4rem; opacity: 0.5"
                                        >folder_open</span
                                    >
                                </div>
                                <h3>No files yet</h3>
                                <p>Upload your first file to get started!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Button -->
        <button
            class="btn btn-fab hidden"
            id="uploadFab"
            onclick="document.getElementById('fileInput').click()"
        >
            <span class="material-icons">add</span>
        </button>

        <!-- Preview Modal -->
        <div class="preview-modal" id="previewModal">
            <div class="preview-content">
                <div class="preview-header">
                    <h3 class="preview-title" id="previewTitle">
                        File Preview
                    </h3>
                    <button
                        class="preview-close"
                        onclick="fileNest.closePreview()"
                    >
                        <span class="material-icons">close</span>
                    </button>
                </div>
                <div class="preview-body" id="previewBody">
                    <!-- Preview content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Alerts Container -->
        <div class="alerts-container" id="alertsContainer"></div>

        <script>
            class FileNest {
                constructor() {
                    this.token = localStorage.getItem("filenest_token");
                    this.user = JSON.parse(
                        localStorage.getItem("filenest_user") || "null",
                    );
                    this.baseUrl = window.location.origin;
                    this.uploadInProgress = false;

                    this.init();
                }

                init() {
                    this.bindEvents();
                    this.checkAuth();
                    this.addRippleEffect();
                    this.addScrollEffect();
                }

                addRippleEffect() {
                    document.querySelectorAll(".btn").forEach((button) => {
                        button.addEventListener("click", this.createRipple);
                    });
                }

                createRipple(event) {
                    const button = event.currentTarget;
                    const circle = document.createElement("span");
                    const diameter = Math.max(
                        button.clientWidth,
                        button.clientHeight,
                    );
                    const radius = diameter / 2;

                    circle.style.width = circle.style.height = `${diameter}px`;
                    circle.style.left = `${event.clientX - button.offsetLeft - radius}px`;
                    circle.style.top = `${event.clientY - button.offsetTop - radius}px`;
                    circle.classList.add("ripple");

                    const ripple = button.getElementsByClassName("ripple")[0];
                    if (ripple) {
                        ripple.remove();
                    }

                    button.appendChild(circle);
                }

                bindEvents() {
                    // Auth tabs
                    document.querySelectorAll(".auth-tab").forEach((tab) => {
                        tab.addEventListener("click", (e) =>
                            this.switchAuthTab(
                                e.target.closest(".auth-tab").dataset.tab,
                            ),
                        );
                    });

                    // Auth forms
                    const loginForm =
                        document.getElementById("loginFormElement");
                    const registerForm = document.getElementById(
                        "registerFormElement",
                    );
                    const logoutBtn = document.getElementById("logoutBtn");

                    if (loginForm) {
                        loginForm.addEventListener("submit", (e) =>
                            this.handleLogin(e),
                        );
                    }
                    if (registerForm) {
                        registerForm.addEventListener("submit", (e) =>
                            this.handleRegister(e),
                        );
                    }
                    if (logoutBtn) {
                        logoutBtn.addEventListener("click", () =>
                            this.logout(),
                        );
                    }

                    // File upload
                    const uploadArea = document.getElementById("uploadArea");
                    const fileInput = document.getElementById("fileInput");

                    if (uploadArea) {
                        uploadArea.addEventListener(
                            "dragover",
                            this.handleDragOver.bind(this),
                        );
                        uploadArea.addEventListener(
                            "dragleave",
                            this.handleDragLeave.bind(this),
                        );
                        uploadArea.addEventListener("drop", (e) =>
                            this.handleDrop(e),
                        );
                    }
                    if (fileInput) {
                        fileInput.addEventListener("change", (e) =>
                            this.handleFileSelect(e),
                        );
                    }

                    // Password confirmation validation
                    const passwordConfirm = document.getElementById(
                        "registerPasswordConfirm",
                    );
                    if (passwordConfirm) {
                        passwordConfirm.addEventListener(
                            "input",
                            this.validatePasswordMatch.bind(this),
                        );
                    }
                }

                switchAuthTab(tab) {
                    // Update tab buttons
                    document
                        .querySelectorAll(".auth-tab")
                        .forEach((t) => t.classList.remove("active"));
                    document
                        .querySelector(`[data-tab="${tab}"]`)
                        .classList.add("active");

                    // Update forms
                    document
                        .querySelectorAll(".auth-form")
                        .forEach((f) => f.classList.remove("active"));
                    document
                        .getElementById(`${tab}Form`)
                        .classList.add("active");
                }

                validatePasswordMatch() {
                    const password =
                        document.getElementById("registerPassword").value;
                    const confirmPassword = document.getElementById(
                        "registerPasswordConfirm",
                    ).value;
                    const confirmField = document.getElementById(
                        "registerPasswordConfirm",
                    );

                    if (confirmPassword && password !== confirmPassword) {
                        confirmField.setCustomValidity(
                            "Passwords do not match",
                        );
                    } else {
                        confirmField.setCustomValidity("");
                    }
                }

                checkAuth() {
                    if (this.token && this.user) {
                        this.showApp();
                        this.loadFiles();
                        this.updateHeader(true);
                    } else {
                        this.showAuth();
                        this.updateHeader(false);
                    }
                }

                showAuth() {
                    document.getElementById("authSection").style.display =
                        "block";
                    document
                        .getElementById("appSection")
                        .classList.remove("active");
                    document
                        .getElementById("uploadFab")
                        .classList.add("hidden");

                    // Reset child element animations
                    const childElements = [
                        document.querySelector(".user-info"),
                        document.querySelector(".upload-section"),
                        document.querySelector(".stats"),
                        document.querySelector(".files-section"),
                    ].filter((el) => el);

                    childElements.forEach((element) => {
                        element.style.animation = "";
                        element.style.opacity = "0";
                        element.style.transform =
                            "translateY(30px) rotate(-90deg) scale(0.9)";
                    });

                    // Update header for logged out state
                    this.updateHeader(false);
                }

                showApp() {
                    document.getElementById("authSection").style.display =
                        "none";
                    document
                        .getElementById("appSection")
                        .classList.add("active");
                    document.getElementById("userName").textContent =
                        this.user.name;
                    document.getElementById("userEmail").textContent =
                        this.user.email;
                    document
                        .getElementById("uploadFab")
                        .classList.remove("hidden");

                    // Add staggered spin animations to child elements
                    const childElements = [
                        document.querySelector(".user-info"),
                        document.querySelector(".upload-section"),
                        document.querySelector(".stats"),
                        document.querySelector(".files-section"),
                    ].filter((el) => el); // Filter out null elements

                    childElements.forEach((element, index) => {
                        element.style.animation = `fadeInSpinChild 0.6s ease-out ${index * 0.1}s both`;
                    });

                    // Update header for logged in state
                    this.updateHeader(true);
                }

                updateHeader(isLoggedIn) {
                    const headerText = document.getElementById("headerText");
                    const headerUserInfo =
                        document.getElementById("headerUserInfo");
                    const headerUserName =
                        document.getElementById("headerUserName");
                    const headerLogoutBtn =
                        document.getElementById("headerLogoutBtn");

                    if (isLoggedIn && this.user) {
                        // Hide text with animation
                        headerText.classList.add("hide");

                        // Show user info after text fade out
                        setTimeout(() => {
                            headerText.style.display = "none";
                            headerUserInfo.style.display = "flex";
                            headerUserName.textContent = `Welcome, ${this.user.name}!`;

                            // Trigger show animation
                            setTimeout(() => {
                                headerUserInfo.classList.add("show");
                            }, 50);
                        }, 300);

                        // Add logout functionality to header button
                        headerLogoutBtn.onclick = () => this.logout();
                    } else {
                        // Hide user info with animation
                        headerUserInfo.classList.remove("show");

                        // Show text after user info fade out
                        setTimeout(() => {
                            headerUserInfo.style.display = "none";
                            headerText.style.display = "block";
                            headerText.classList.remove("hide");
                        }, 300);
                    }
                }

                async handleLogin(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData);

                    try {
                        this.setButtonLoading("loginBtn", true);
                        const response = await this.apiCall(
                            "/auth/login",
                            "POST",
                            data,
                        );

                        if (response.token) {
                            this.setAuth(response.token, response.user);
                            this.showAlert(
                                "Welcome back! Login successful.",
                                "success",
                            );
                            this.showApp();
                            this.loadFiles();
                            e.target.reset();
                        } else {
                            this.showAlert(
                                response.message || "Login failed",
                                "error",
                            );
                        }
                    } catch (error) {
                        this.showAlert(
                            error.message || "Login failed. Please try again.",
                            "error",
                        );
                    } finally {
                        this.setButtonLoading("loginBtn", false);
                    }
                }

                async handleRegister(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData);

                    if (data.password !== data.password_confirmation) {
                        this.showAlert("Passwords do not match", "error");
                        return;
                    }

                    try {
                        this.setButtonLoading("registerBtn", true);
                        const response = await this.apiCall(
                            "/auth/register",
                            "POST",
                            data,
                        );

                        if (response.token) {
                            this.setAuth(response.token, response.user);
                            this.showAlert(
                                "Account created successfully! Welcome to FileNest.",
                                "success",
                            );
                            this.showApp();
                            this.loadFiles();
                            e.target.reset();
                        } else {
                            this.showAlert(
                                response.message || "Registration failed",
                                "error",
                            );
                            if (response.errors) {
                                response.errors.forEach((error) =>
                                    this.showAlert(error, "error"),
                                );
                            }
                        }
                    } catch (error) {
                        this.showAlert(
                            error.message ||
                                "Registration failed. Please try again.",
                            "error",
                        );
                    } finally {
                        this.setButtonLoading("registerBtn", false);
                    }
                }

                logout() {
                    localStorage.removeItem("filenest_token");
                    localStorage.removeItem("filenest_user");
                    this.token = null;
                    this.user = null;
                    this.showAuth();
                    this.showAlert(
                        "You have been logged out successfully",
                        "success",
                    );
                }

                setAuth(token, user) {
                    this.token = token;
                    this.user = user;
                    localStorage.setItem("filenest_token", token);
                    localStorage.setItem("filenest_user", JSON.stringify(user));
                }

                handleDragOver(e) {
                    e.preventDefault();
                    e.currentTarget.classList.add("dragover");
                }

                handleDragLeave(e) {
                    e.preventDefault();
                    e.currentTarget.classList.remove("dragover");
                }

                handleDrop(e) {
                    e.preventDefault();
                    e.currentTarget.classList.remove("dragover");
                    const files = Array.from(e.dataTransfer.files);
                    this.uploadFiles(files);
                }

                handleFileSelect(e) {
                    const files = Array.from(e.target.files);
                    this.uploadFiles(files);
                    e.target.value = ""; // Reset input
                }

                async uploadFiles(files) {
                    if (this.uploadInProgress) {
                        this.showAlert(
                            "Upload already in progress. Please wait.",
                            "error",
                        );
                        return;
                    }

                    if (files.length === 0) return;

                    this.uploadInProgress = true;
                    const progressBar =
                        document.getElementById("uploadProgress");
                    const progressText =
                        document.getElementById("uploadProgressText");
                    const uploadStatus =
                        document.getElementById("uploadStatus");

                    progressBar.classList.remove("hidden");
                    progressText.classList.remove("hidden");
                    uploadStatus.classList.remove("hidden");

                    let totalFiles = files.length;
                    let completedFiles = 0;

                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];

                        this.updateUploadStatus(
                            `Uploading ${file.name}... (${i + 1}/${totalFiles})`,
                        );

                        try {
                            await this.uploadFile(file, (progress) => {
                                // Calculate overall progress: completed files + current file progress
                                const overallProgress =
                                    ((completedFiles + progress / 100) /
                                        totalFiles) *
                                    100;
                                this.updateProgressBar(overallProgress);
                            });

                            completedFiles++;
                            this.showAlert(
                                `‚úÖ ${file.name} uploaded successfully!`,
                                "success",
                            );
                        } catch (error) {
                            this.showAlert(
                                `‚ùå Failed to upload ${file.name}: ${error.message}`,
                                "error",
                            );
                        }
                    }

                    this.updateUploadStatus(
                        `Upload complete! ${completedFiles}/${totalFiles} files uploaded.`,
                    );

                    // Hide progress bar after 2 seconds
                    setTimeout(() => {
                        progressBar.classList.add("hidden");
                        progressText.classList.add("hidden");
                        uploadStatus.classList.add("hidden");
                        this.resetProgressBar();
                    }, 2000);

                    this.uploadInProgress = false;
                    this.loadFiles(); // Refresh the files list
                }

                async uploadFile(file, onProgress) {
                    return new Promise((resolve, reject) => {
                        const formData = new FormData();
                        formData.append("file", file);

                        const xhr = new XMLHttpRequest();

                        // Handle upload progress
                        xhr.upload.addEventListener("progress", (event) => {
                            if (event.lengthComputable) {
                                const progress = Math.round(
                                    (event.loaded / event.total) * 100,
                                );
                                if (onProgress) {
                                    onProgress(progress);
                                }
                            }
                        });

                        // Handle completion
                        xhr.addEventListener("load", () => {
                            if (xhr.status >= 200 && xhr.status < 300) {
                                try {
                                    const response = JSON.parse(
                                        xhr.responseText,
                                    );
                                    resolve(response);
                                } catch (error) {
                                    reject(
                                        new Error("Invalid response format"),
                                    );
                                }
                            } else {
                                try {
                                    const errorResponse = JSON.parse(
                                        xhr.responseText,
                                    );
                                    reject(
                                        new Error(
                                            errorResponse.message ||
                                                `Upload failed with status ${xhr.status}`,
                                        ),
                                    );
                                } catch (error) {
                                    reject(
                                        new Error(
                                            `Upload failed with status ${xhr.status}`,
                                        ),
                                    );
                                }
                            }
                        });

                        // Handle errors
                        xhr.addEventListener("error", () => {
                            reject(
                                new Error(
                                    "Network error occurred during upload",
                                ),
                            );
                        });

                        // Handle timeouts
                        xhr.addEventListener("timeout", () => {
                            reject(new Error("Upload timed out"));
                        });

                        // Set up the request
                        xhr.open("POST", `${this.baseUrl}/upload`);

                        // Add authorization header if token exists
                        if (this.token) {
                            xhr.setRequestHeader(
                                "Authorization",
                                `Bearer ${this.token}`,
                            );
                        }

                        // Set timeout (30 seconds)
                        xhr.timeout = 30000;

                        // Send the request
                        xhr.send(formData);
                    });
                }

                async loadFiles() {
                    try {
                        document
                            .getElementById("loadingFiles")
                            .classList.remove("hidden");
                        const response = await this.apiCall("/files", "GET");
                        this.displayFiles(response.files || []);
                        this.updateStats(response);
                    } catch (error) {
                        this.showAlert(
                            "Failed to load files: " + error.message,
                            "error",
                        );
                    } finally {
                        document
                            .getElementById("loadingFiles")
                            .classList.add("hidden");
                    }
                }

                displayFiles(files) {
                    const filesGrid = document.getElementById("filesGrid");

                    if (files.length === 0) {
                        filesGrid.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <span class="material-icons" style="font-size: 4rem; opacity: 0.5;">folder_open</span>
                            </div>
                            <h3>No files yet</h3>
                            <p>Upload your first file to get started!</p>
                        </div>
                    `;
                        return;
                    }

                    filesGrid.innerHTML = files
                        .map(
                            (file) => `
                    <div class="file-card">
                        <div class="file-info">
                            <div class="file-icon">
                                <span class="material-icons">${this.getFileIcon(file.content_type)}</span>
                            </div>
                            <div class="file-details">
                                <h3 title="${this.escapeHtml(file.filename)}">
                                    <input
                                        type="text"
                                        class="file-name-editable"
                                        value="${this.escapeHtml(file.filename)}"
                                        data-file-id="${file.id}"
                                        data-original-name="${this.escapeHtml(file.filename)}"
                                        readonly
                                        onclick="this.readOnly = false; this.select(); fileNest.showRenameControls(${file.id});"
                                        onblur="fileNest.handleRenameBlur(this)"
                                        onkeydown="fileNest.handleRenameKeydown(event, this)"
                                    />
                                    <div class="rename-controls" id="renameControls${file.id}">
                                        <button class="btn btn-small" onclick="fileNest.saveRename(${file.id})">
                                            <span class="material-icons">check</span>
                                        </button>
                                        <button class="btn btn-small btn-secondary" onclick="fileNest.cancelRename(${file.id})">
                                            <span class="material-icons">close</span>
                                        </button>
                                    </div>
                                </h3>
                                <div class="file-meta">
                                    <span>
                                        <span class="material-icons">data_usage</span>
                                        ${file.human_readable_size}
                                    </span>
                                    <span>
                                        <span class="material-icons">event</span>
                                        ${new Date(file.uploaded_at).toLocaleDateString()}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="btn btn-small" onclick="fileNest.startRename(${file.id})">
                                <span class="material-icons">edit</span>
                            </button>
                            ${
                                this.canPreviewFile(file)
                                    ? `
                            <button class="btn btn-small" onclick="fileNest.previewFile(${file.id}, '${this.escapeHtml(file.filename)}', '${file.content_type}')">
                                <span class="material-icons">visibility</span>
                            </button>
                            `
                                    : ""
                            }
                            <button class="btn btn-small btn-secondary" onclick="fileNest.downloadFile(${file.id})">
                                <span class="material-icons">download</span>
                            </button>
                            <button class="btn btn-small btn-danger" onclick="fileNest.deleteFile(${file.id}, '${this.escapeHtml(file.filename)}')">
                                <span class="material-icons">delete</span>
                            </button>
                        </div>
                    </div>
                `,
                        )
                        .join("");
                }

                updateStats(data) {
                    // Animate numbers
                    this.animateNumber("totalFiles", data.total_count || 0);
                    document.getElementById("totalSize").textContent =
                        data.human_readable_total_size || "0 B";

                    // Calculate image and document counts
                    const files = data.files || [];
                    const imageCount = files.filter((f) => f.is_image).length;
                    const documentCount = files.filter((f) => f.is_text).length;

                    this.animateNumber("imageFiles", imageCount);
                    this.animateNumber("documentFiles", documentCount);
                }

                animateNumber(elementId, targetNumber) {
                    const element = document.getElementById(elementId);
                    const startNumber = parseInt(element.textContent) || 0;
                    const duration = 1000;
                    const startTime = performance.now();

                    const animate = (currentTime) => {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        const currentNumber = Math.floor(
                            startNumber +
                                (targetNumber - startNumber) * progress,
                        );

                        element.textContent = currentNumber;

                        if (progress < 1) {
                            requestAnimationFrame(animate);
                        }
                    };

                    requestAnimationFrame(animate);
                }

                getFileIcon(contentType) {
                    if (contentType.startsWith("image/")) {
                        if (contentType.includes("svg")) return "palette";
                        return "image";
                    }
                    if (contentType.includes("text/plain"))
                        return "description";
                    if (contentType.includes("markdown")) return "article";
                    if (contentType.includes("csv")) return "table_chart";
                    return "insert_drive_file";
                }

                canPreviewFile(file) {
                    const previewableTypes = [
                        "image/jpeg",
                        "image/jpg",
                        "image/png",
                        "image/gif",
                        "image/svg+xml",
                        "text/plain",
                        "text/markdown",
                        "text/csv",
                    ];
                    return previewableTypes.includes(file.content_type);
                }

                async previewFile(fileId, filename, contentType) {
                    const modal = document.getElementById("previewModal");
                    const title = document.getElementById("previewTitle");
                    const body = document.getElementById("previewBody");

                    // Show modal and loading state
                    modal.classList.add("active");
                    title.textContent = filename;
                    body.innerHTML = `
                        <div class="preview-loading">
                            <div class="spinner"></div>
                            <p>Loading preview...</p>
                        </div>
                    `;

                    try {
                        const response = await fetch(
                            `${this.baseUrl}/files/${fileId}/download`,
                            {
                                method: "GET",
                                headers: {
                                    Authorization: `Bearer ${this.token}`,
                                },
                            },
                        );

                        if (!response.ok) {
                            throw new Error("Failed to load file");
                        }

                        if (contentType.startsWith("image/")) {
                            // For images, create blob URL and display
                            const blob = await response.blob();
                            const imageUrl = URL.createObjectURL(blob);

                            body.innerHTML = `
                                <img src="${imageUrl}" alt="${this.escapeHtml(filename)}" class="preview-image" onload="URL.revokeObjectURL(this.src)">
                            `;
                        } else if (contentType.startsWith("text/")) {
                            // For text files, display content
                            const text = await response.text();
                            body.innerHTML = `
                                <div class="preview-text">${this.escapeHtml(text)}</div>
                            `;
                        }
                    } catch (error) {
                        body.innerHTML = `
                            <div class="preview-error">
                                <span class="material-icons" style="font-size: 3rem; margin-bottom: 1rem; display: block;">error_outline</span>
                                <h3>Preview not available</h3>
                                <p>${error.message}</p>
                            </div>
                        `;
                    }
                }

                closePreview() {
                    const modal = document.getElementById("previewModal");
                    modal.classList.remove("active");

                    // Clean up any blob URLs to prevent memory leaks
                    const images = modal.querySelectorAll("img");
                    images.forEach((img) => {
                        if (img.src.startsWith("blob:")) {
                            URL.revokeObjectURL(img.src);
                        }
                    });
                }

                startRename(fileId) {
                    const input = document.querySelector(
                        `input[data-file-id="${fileId}"]`,
                    );
                    if (input) {
                        input.readOnly = false;
                        input.focus();
                        input.select();
                        this.showRenameControls(fileId);
                    }
                }

                showRenameControls(fileId) {
                    const controls = document.getElementById(
                        `renameControls${fileId}`,
                    );
                    if (controls) {
                        controls.classList.add("active");
                    }
                }

                hideRenameControls(fileId) {
                    const controls = document.getElementById(
                        `renameControls${fileId}`,
                    );
                    if (controls) {
                        controls.classList.remove("active");
                    }
                }

                async handleRenameBlur(input) {
                    // Don't auto-save on blur, just hide controls if unchanged
                    const fileId = input.dataset.fileId;
                    const originalName = input.dataset.originalName;
                    const newName = input.value.trim();

                    if (newName === originalName) {
                        this.cancelRename(fileId);
                    }
                }

                handleRenameKeydown(event, input) {
                    const fileId = input.dataset.fileId;

                    if (event.key === "Enter") {
                        event.preventDefault();
                        this.saveRename(fileId);
                    } else if (event.key === "Escape") {
                        event.preventDefault();
                        this.cancelRename(fileId);
                    }
                }

                async saveRename(fileId) {
                    const input = document.querySelector(
                        `input[data-file-id="${fileId}"]`,
                    );
                    if (!input) return;

                    const originalName = input.dataset.originalName;
                    const newName = input.value.trim();

                    if (newName === originalName || newName === "") {
                        this.cancelRename(fileId);
                        return;
                    }

                    // Validate filename
                    if (!this.validateFileName(newName)) {
                        this.cancelRename(fileId);
                        return;
                    }

                    try {
                        await this.renameFile(fileId, newName);
                        input.dataset.originalName = newName;
                        input.readOnly = true;
                        this.hideRenameControls(fileId);
                        this.showAlert(
                            `‚úÖ File renamed to "${newName}"`,
                            "success",
                        );
                        // Refresh the file list to update all references
                        this.loadFiles();
                    } catch (error) {
                        input.value = originalName;
                        this.cancelRename(fileId);
                        this.showAlert(
                            `‚ùå Failed to rename file: ${error.message}`,
                            "error",
                        );
                    }
                }

                cancelRename(fileId) {
                    const input = document.querySelector(
                        `input[data-file-id="${fileId}"]`,
                    );
                    if (input) {
                        input.value = input.dataset.originalName;
                        input.readOnly = true;
                        this.hideRenameControls(fileId);
                    }
                }

                validateFileName(filename) {
                    // Check for empty filename
                    if (!filename || filename.trim().length === 0) {
                        this.showAlert("Filename cannot be empty", "error");
                        return false;
                    }

                    // Check length
                    if (filename.length > 255) {
                        this.showAlert(
                            "Filename too long (maximum 255 characters)",
                            "error",
                        );
                        return false;
                    }

                    // Check for invalid characters
                    const invalidChars = /[<>:"/\\|?*\x00-\x1f]/;
                    if (invalidChars.test(filename)) {
                        this.showAlert(
                            "Filename contains invalid characters",
                            "error",
                        );
                        return false;
                    }

                    // Check for reserved names (Windows)
                    const reservedNames = [
                        "CON",
                        "PRN",
                        "AUX",
                        "NUL",
                        "COM1",
                        "COM2",
                        "COM3",
                        "COM4",
                        "COM5",
                        "COM6",
                        "COM7",
                        "COM8",
                        "COM9",
                        "LPT1",
                        "LPT2",
                        "LPT3",
                        "LPT4",
                        "LPT5",
                        "LPT6",
                        "LPT7",
                        "LPT8",
                        "LPT9",
                    ];
                    const baseName = filename.split(".")[0].toUpperCase();
                    if (reservedNames.includes(baseName)) {
                        this.showAlert(
                            "Filename uses a reserved system name",
                            "error",
                        );
                        return false;
                    }

                    // Check if filename starts or ends with dot or space
                    if (
                        filename.startsWith(".") ||
                        filename.startsWith(" ") ||
                        filename.endsWith(" ")
                    ) {
                        this.showAlert(
                            "Filename cannot start or end with a dot or space",
                            "error",
                        );
                        return false;
                    }

                    // Check for file extension
                    const allowedExtensions = [
                        ".jpg",
                        ".jpeg",
                        ".png",
                        ".gif",
                        ".svg",
                        ".txt",
                        ".md",
                        ".markdown",
                        ".csv",
                    ];
                    const extension = filename
                        .substring(filename.lastIndexOf("."))
                        .toLowerCase();
                    if (!extension || !allowedExtensions.includes(extension)) {
                        this.showAlert(
                            `File must have a valid extension: ${allowedExtensions.join(", ")}`,
                            "error",
                        );
                        return false;
                    }

                    return true;
                }

                async renameFile(fileId, newFilename) {
                    try {
                        const response = await this.apiCall(
                            `/files/${fileId}`,
                            "PATCH",
                            { file: { filename: newFilename } },
                        );
                        return response;
                    } catch (error) {
                        throw error;
                    }
                }

                async downloadFile(fileId) {
                    try {
                        const response = await fetch(
                            `${this.baseUrl}/files/${fileId}/download`,
                            {
                                method: "GET",
                                headers: {
                                    Authorization: `Bearer ${this.token}`,
                                },
                            },
                        );

                        if (!response.ok) {
                            let errorMsg = "Download failed";
                            try {
                                const error = await response.json();
                                errorMsg = error.message || errorMsg;
                            } catch (e) {}
                            this.showAlert(errorMsg, "error");
                            return;
                        }

                        // Try to extract filename from Content-Disposition header
                        let filename = "";
                        const disposition = response.headers.get(
                            "Content-Disposition",
                        );
                        if (disposition && disposition.includes("filename=")) {
                            filename = disposition
                                .split("filename=")[1]
                                .split(";")[0]
                                .replace(/['"]/g, "")
                                .trim();
                        }

                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement("a");
                        link.href = url;
                        link.download = filename || "";
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        window.URL.revokeObjectURL(url);

                        this.showAlert(
                            "File downloaded successfully",
                            "success",
                        );
                    } catch (error) {
                        this.showAlert("Failed to download file", "error");
                    }
                }

                async deleteFile(fileId, filename) {
                    if (
                        !confirm(
                            `Are you sure you want to delete "${filename}"?\n\nThis action cannot be undone.`,
                        )
                    ) {
                        return;
                    }

                    try {
                        await this.apiCall(`/files/${fileId}`, "DELETE");
                        this.showAlert(
                            `üóëÔ∏è "${filename}" deleted successfully`,
                            "success",
                        );
                        this.loadFiles();
                    } catch (error) {
                        this.showAlert(
                            "Failed to delete file: " + error.message,
                            "error",
                        );
                    }
                }

                async apiCall(
                    endpoint,
                    method = "GET",
                    data = null,
                    isFormData = false,
                ) {
                    const url = `${this.baseUrl}${endpoint}`;
                    const options = {
                        method,
                        headers: {},
                    };

                    if (this.token) {
                        options.headers["Authorization"] =
                            `Bearer ${this.token}`;
                    }

                    if (data) {
                        if (isFormData) {
                            options.body = data;
                        } else {
                            options.headers["Content-Type"] =
                                "application/json";
                            options.body = JSON.stringify(data);
                        }
                    }

                    const response = await fetch(url, options);

                    if (!response.ok) {
                        let errorMessage = `HTTP ${response.status}`;
                        try {
                            const errorData = await response.json();
                            errorMessage = errorData.message || errorMessage;
                        } catch (e) {
                            // Use default error message if response is not JSON
                        }
                        throw new Error(errorMessage);
                    }

                    return await response.json();
                }

                showAlert(message, type = "info") {
                    const alertsContainer =
                        document.getElementById("alertsContainer");
                    const alert = document.createElement("div");
                    alert.className = `alert alert-${type === "error" ? "error" : "success"}`;

                    alert.innerHTML = `
                    <span>${message}</span>
                    <button class="alert-close" onclick="this.parentElement.remove()">
                        <span class="material-icons">close</span>
                    </button>
                `;

                    alertsContainer.appendChild(alert);

                    // Auto-remove after 5 seconds
                    setTimeout(() => {
                        if (alert.parentElement) {
                            alert.remove();
                        }
                    }, 5000);
                }

                setButtonLoading(buttonId, loading) {
                    const button = document.getElementById(buttonId);
                    const btnText = button.querySelector(".btn-text");

                    if (loading) {
                        button.disabled = true;
                        btnText.innerHTML =
                            '<span class="spinner" style="width: 16px; height: 16px; margin-right: 8px;"></span>Loading...';
                    } else {
                        button.disabled = false;
                        if (buttonId === "loginBtn") {
                            btnText.textContent = "Login";
                        } else if (buttonId === "registerBtn") {
                            btnText.textContent = "Create Account";
                        }
                    }
                }

                addScrollEffect() {
                    const header = document.getElementById("mainHeader");
                    if (!header) return;

                    let lastScrollY = window.scrollY;

                    window.addEventListener("scroll", () => {
                        const currentScrollY = window.scrollY;

                        if (
                            currentScrollY > lastScrollY &&
                            currentScrollY > 100
                        ) {
                            // Scrolling down - slightly reduce opacity
                            header.style.background =
                                "rgba(102, 126, 234, 0.85)";
                            header.style.transform = "translateY(-2px)";
                        } else {
                            // Scrolling up or at top - restore opacity
                            header.style.background =
                                "rgba(102, 126, 234, 0.95)";
                            header.style.transform = "translateY(0)";
                        }

                        lastScrollY = currentScrollY;
                    });
                }

                escapeHtml(text) {
                    const div = document.createElement("div");
                    div.textContent = text;
                    return div.innerHTML;
                }

                updateProgressBar(progress) {
                    const progressFill =
                        document.getElementById("uploadProgressFill");
                    const progressText =
                        document.getElementById("uploadProgressText");

                    const roundedProgress = Math.round(progress);

                    if (progressFill) {
                        progressFill.style.width = `${progress}%`;
                    }

                    if (progressText) {
                        progressText.textContent = `${roundedProgress}%`;
                    }
                }

                updateUploadStatus(message) {
                    const uploadStatus =
                        document.getElementById("uploadStatus");
                    if (uploadStatus) {
                        uploadStatus.textContent = message;
                    }
                }

                resetProgressBar() {
                    const progressFill =
                        document.getElementById("uploadProgressFill");
                    const progressText =
                        document.getElementById("uploadProgressText");

                    if (progressFill) {
                        progressFill.style.width = "0%";
                    }

                    if (progressText) {
                        progressText.textContent = "0%";
                    }
                }
            }

            // Initialize the app when DOM is loaded
            document.addEventListener("DOMContentLoaded", function () {
                window.fileNest = new FileNest();
            });

            // Handle browser back/forward
            window.addEventListener("popstate", function () {
                if (window.fileNest) {
                    window.fileNest.checkAuth();
                }
            });

            // Close preview modal on escape key
            document.addEventListener("keydown", function (e) {
                if (e.key === "Escape") {
                    const modal = document.getElementById("previewModal");
                    if (modal && modal.classList.contains("active")) {
                        window.fileNest.closePreview();
                    }
                }
            });

            // Close preview modal on backdrop click
            document.addEventListener("click", function (e) {
                if (e.target.id === "previewModal") {
                    window.fileNest.closePreview();
                }
            });
        </script>
    </body>
</html>
