<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>FileNest - Your Personal File Cache</title>
        <link rel="icon" href="/FileNest_Logo.png" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
            rel="stylesheet"
        />
        <style>
            :root {
                --primary-500: #0088ff;
                --primary-600: #0070f0;
                --secondary-500: #d946ef;
                --secondary-600: #c026d3;
                --success-500: #22c55e;
                --error-500: #ef4444;
                --gray-50: #f8fafc;
                --gray-100: #f1f5f9;
                --gray-200: #e2e8f0;
                --gray-500: #64748b;
                --gray-600: #475569;
                --gray-700: #334155;
                --gray-800: #1e293b;
                --gray-900: #0f172a;
                --white: #ffffff;
                --radius: 0.5rem;
                --radius-lg: 1rem;
                --radius-xl: 1.5rem;
                --radius-2xl: 2rem;
                --shadow:
                    0 1px 3px 0 rgb(0 0 0 / 0.1),
                    0 1px 2px -1px rgb(0 0 0 / 0.1);
                --shadow-lg:
                    0 10px 15px -3px rgb(0 0 0 / 0.1),
                    0 4px 6px -4px rgb(0 0 0 / 0.1);
                --shadow-xl:
                    0 20px 25px -5px rgb(0 0 0 / 0.1),
                    0 8px 10px -6px rgb(0 0 0 / 0.1);
                --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    "Inter",
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Roboto,
                    sans-serif;
                background: linear-gradient(
                    135deg,
                    var(--primary-500) 0%,
                    var(--secondary-600) 100%
                );
                min-height: 100vh;
                color: var(--gray-900);
                overflow-x: hidden;
            }

            .bg-animation {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: -1;
                overflow: hidden;
            }

            .floating-shapes {
                position: absolute;
                width: 100%;
                height: 100%;
            }

            .shape {
                position: absolute;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 50%;
                animation: float 6s ease-in-out infinite;
                backdrop-filter: blur(10px);
            }

            .shape:nth-child(1) {
                width: 80px;
                height: 80px;
                top: 20%;
                left: 20%;
                animation-delay: 0s;
            }

            .shape:nth-child(2) {
                width: 120px;
                height: 120px;
                top: 60%;
                left: 80%;
                animation-delay: 2s;
            }

            .shape:nth-child(3) {
                width: 60px;
                height: 60px;
                top: 80%;
                left: 10%;
                animation-delay: 4s;
            }

            .shape:nth-child(4) {
                width: 100px;
                height: 100px;
                top: 10%;
                left: 70%;
                animation-delay: 1s;
            }

            @keyframes float {
                0%,
                100% {
                    transform: translateY(0px) rotate(0deg);
                    opacity: 0.7;
                }
                50% {
                    transform: translateY(-20px) rotate(180deg);
                    opacity: 1;
                }
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 1rem;
                position: relative;
                z-index: 1;
            }

            .header {
                text-align: center;
                color: var(--white);
                padding: 2rem 0 3rem;
                animation: slideDown 0.8s ease-out;
            }

            .logo-container {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 1rem;
                margin-bottom: 1rem;
                animation: logoGlow 2s ease-in-out infinite alternate;
            }

            .logo {
                width: 80px;
                height: 80px;
                border-radius: var(--radius-xl);
                box-shadow: var(--shadow-2xl);
                transition: transform 0.3s ease;
            }

            .logo:hover {
                transform: scale(1.1) rotate(5deg);
            }

            .header h1 {
                font-size: clamp(2.5rem, 5vw, 4rem);
                font-weight: 800;
                margin: 0;
                text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
                background: linear-gradient(45deg, var(--white), #e0efff);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .header .subtitle {
                font-size: clamp(1rem, 2.5vw, 1.5rem);
                opacity: 0.95;
                margin-top: 0.5rem;
                font-weight: 400;
                max-width: 600px;
                margin-left: auto;
                margin-right: auto;
            }

            @keyframes logoGlow {
                0% {
                    filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
                }
                100% {
                    filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.8));
                }
            }

            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-50px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .main-content {
                background: var(--white);
                border-radius: var(--radius-2xl);
                box-shadow: var(--shadow-2xl);
                overflow: hidden;
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                animation: slideUp 0.8s ease-out 0.2s both;
                margin-bottom: 2rem;
            }

            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(50px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .auth-section {
                padding: 3rem;
                background: linear-gradient(
                    135deg,
                    var(--gray-50) 0%,
                    var(--white) 100%
                );
            }

            .auth-tabs {
                display: flex;
                justify-content: center;
                margin-bottom: 2rem;
                background: var(--gray-100);
                border-radius: var(--radius-lg);
                padding: 0.25rem;
                position: relative;
            }

            .tab-indicator {
                position: absolute;
                top: 0.25rem;
                bottom: 0.25rem;
                background: var(--white);
                border-radius: var(--radius);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: var(--shadow);
                z-index: 1;
                width: calc(50% - 0.25rem);
                left: 0.25rem;
            }

            .tab-indicator.register {
                left: calc(50% + 0.125rem);
            }

            .auth-tab {
                flex: 1;
                max-width: 200px;
                padding: 0.875rem 1.5rem;
                background: transparent;
                border: none;
                border-radius: var(--radius);
                cursor: pointer;
                font-weight: 600;
                font-size: 0.875rem;
                transition: all 0.3s ease;
                color: var(--gray-600);
                position: relative;
                z-index: 2;
            }

            .auth-tab.active {
                color: var(--primary-600);
            }

            .auth-form {
                max-width: 400px;
                margin: 0 auto;
                display: none;
                animation: fadeIn 0.5s ease-out;
            }

            .auth-form.active {
                display: block;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .auth-form h2 {
                text-align: center;
                margin-bottom: 2rem;
                color: var(--gray-900);
                font-size: 1.75rem;
                font-weight: 700;
            }

            .form-group {
                margin-bottom: 1.5rem;
            }

            .form-group label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 600;
                color: var(--gray-700);
                font-size: 0.875rem;
            }

            .form-group input {
                width: 100%;
                padding: 1rem;
                border: 2px solid var(--gray-200);
                border-radius: var(--radius-lg);
                font-size: 1rem;
                transition: all 0.3s ease;
                background: var(--white);
                font-family: inherit;
            }

            .form-group input:focus {
                outline: none;
                border-color: var(--primary-500);
                box-shadow: 0 0 0 3px rgba(0, 136, 255, 0.1);
                transform: translateY(-2px);
            }

            .btn {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                background: linear-gradient(
                    135deg,
                    var(--primary-500),
                    var(--primary-600)
                );
                color: var(--white);
                border: none;
                padding: 1rem 2rem;
                border-radius: var(--radius-lg);
                cursor: pointer;
                font-size: 1rem;
                font-weight: 600;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                width: 100%;
                position: relative;
                overflow: hidden;
                font-family: inherit;
            }

            .btn::before {
                content: "";
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.2),
                    transparent
                );
                transition: left 0.5s;
            }

            .btn:hover::before {
                left: 100%;
            }

            .btn:hover:not(:disabled) {
                transform: translateY(-3px);
                box-shadow: var(--shadow-xl);
            }

            .btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            .btn-secondary {
                background: linear-gradient(
                    135deg,
                    var(--gray-600),
                    var(--gray-700)
                );
            }

            .btn-small {
                padding: 0.75rem 1.5rem;
                font-size: 0.875rem;
            }

            .app-section {
                display: none;
                padding: 2rem;
            }

            .app-section.active {
                display: block;
            }

            .user-info {
                background: linear-gradient(
                    135deg,
                    var(--success-500),
                    #16a34a
                );
                color: var(--white);
                padding: 2rem;
                border-radius: var(--radius-xl);
                margin-bottom: 2rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: var(--shadow-lg);
            }

            .upload-section {
                background: linear-gradient(135deg, #f0f7ff, #fdf4ff);
                padding: 2rem;
                border-radius: var(--radius-xl);
                margin-bottom: 2rem;
                text-align: center;
                border: 1px solid #e0efff;
            }

            .upload-area {
                border: 3px dashed var(--gray-300);
                border-radius: var(--radius-xl);
                padding: 3rem 2rem;
                margin: 2rem 0;
                transition: all 0.3s ease;
                cursor: pointer;
                background: var(--white);
            }

            .upload-area:hover {
                border-color: var(--primary-500);
                transform: translateY(-5px);
                box-shadow: var(--shadow-xl);
            }

            .upload-area.dragover {
                border-color: var(--primary-500);
                background: #f0f7ff;
                transform: scale(1.02);
            }

            .upload-icon {
                font-size: 4rem;
                margin-bottom: 1rem;
                color: var(--primary-500);
                animation: bounce 2s infinite;
            }

            @keyframes bounce {
                0%,
                20%,
                50%,
                80%,
                100% {
                    transform: translateY(0);
                }
                40% {
                    transform: translateY(-10px);
                }
                60% {
                    transform: translateY(-5px);
                }
            }

            .stats {
                background: linear-gradient(
                    135deg,
                    var(--primary-600),
                    var(--secondary-600)
                );
                color: var(--white);
                padding: 2rem;
                border-radius: var(--radius-xl);
                margin-bottom: 2rem;
                box-shadow: var(--shadow-lg);
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 2rem;
            }

            .stat-item {
                text-align: center;
            }

            .stat-value {
                font-size: 2.5rem;
                font-weight: 800;
                line-height: 1;
                margin-bottom: 0.5rem;
            }

            .files-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
                gap: 1.5rem;
            }

            .file-card {
                background: var(--white);
                border: 1px solid var(--gray-200);
                border-radius: var(--radius-xl);
                padding: 1.5rem;
                box-shadow: var(--shadow);
                transition: all 0.3s ease;
            }

            .file-card:hover {
                transform: translateY(-8px);
                box-shadow: var(--shadow-xl);
            }

            .empty-state {
                text-align: center;
                padding: 4rem 2rem;
                color: var(--gray-500);
                grid-column: 1 / -1;
            }

            .alerts-container {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                max-width: 400px;
            }

            .alert {
                padding: 1rem 1.5rem;
                border-radius: var(--radius-lg);
                margin-bottom: 1rem;
                font-weight: 500;
                box-shadow: var(--shadow-xl);
                animation: slideInRight 0.4s ease;
                position: relative;
                padding-right: 3rem;
            }

            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            .alert-success {
                background: linear-gradient(
                    135deg,
                    #f0fdf4,
                    rgba(34, 197, 94, 0.1)
                );
                color: #16a34a;
                border-left: 4px solid var(--success-500);
            }

            .alert-error {
                background: linear-gradient(
                    135deg,
                    #fef2f2,
                    rgba(239, 68, 68, 0.1)
                );
                color: #dc2626;
                border-left: 4px solid var(--error-500);
            }

            .alert-close {
                position: absolute;
                top: 1rem;
                right: 1rem;
                background: none;
                border: none;
                font-size: 1.25rem;
                cursor: pointer;
                color: inherit;
                opacity: 0.7;
            }

            .hidden {
                display: none !important;
            }

            @media (max-width: 768px) {
                .container {
                    padding: 0 0.5rem;
                }
                .auth-section {
                    padding: 2rem 1.5rem;
                }
                .app-section {
                    padding: 1.5rem;
                }
                .user-info {
                    flex-direction: column;
                    gap: 1rem;
                    text-align: center;
                }
                .files-grid {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    </head>
    <body>
        <div class="bg-animation">
            <div class="floating-shapes">
                <div class="shape"></div>
                <div class="shape"></div>
                <div class="shape"></div>
                <div class="shape"></div>
            </div>
        </div>

        <div class="container">
            <div class="header">
                <div class="logo-container">
                    <img
                        src="/FileNest_Logo.png"
                        alt="FileNest Logo"
                        class="logo"
                    />
                    <h1>FileNest</h1>
                </div>
                <p class="subtitle">
                    Your Personal File Cache - Secure, Simple, Fast
                </p>
            </div>

            <div class="main-content">
                <!-- Authentication Section -->
                <div class="auth-section" id="authSection">
                    <div class="auth-tabs">
                        <div class="tab-indicator" id="tabIndicator"></div>
                        <button class="auth-tab active" data-tab="login">
                            Login
                        </button>
                        <button class="auth-tab" data-tab="register">
                            Register
                        </button>
                    </div>

                    <!-- Login Form -->
                    <div class="auth-form active" id="loginForm">
                        <h2>Welcome Back</h2>
                        <form id="loginFormElement">
                            <div class="form-group">
                                <label for="loginEmail">Email Address</label>
                                <input
                                    type="email"
                                    id="loginEmail"
                                    name="email"
                                    required
                                    placeholder="Enter your email"
                                />
                            </div>
                            <div class="form-group">
                                <label for="loginPassword">Password</label>
                                <input
                                    type="password"
                                    id="loginPassword"
                                    name="password"
                                    required
                                    placeholder="Enter your password"
                                />
                            </div>
                            <button type="submit" class="btn" id="loginBtn">
                                <span class="btn-text">Login</span>
                            </button>
                        </form>
                    </div>

                    <!-- Register Form -->
                    <div class="auth-form" id="registerForm">
                        <h2>Create Account</h2>
                        <form id="registerFormElement">
                            <div class="form-group">
                                <label for="registerName">Full Name</label>
                                <input
                                    type="text"
                                    id="registerName"
                                    name="name"
                                    required
                                    placeholder="Enter your full name"
                                />
                            </div>
                            <div class="form-group">
                                <label for="registerEmail">Email Address</label>
                                <input
                                    type="email"
                                    id="registerEmail"
                                    name="email"
                                    required
                                    placeholder="Enter your email"
                                />
                            </div>
                            <div class="form-group">
                                <label for="registerPassword">Password</label>
                                <input
                                    type="password"
                                    id="registerPassword"
                                    name="password"
                                    required
                                    minlength="6"
                                    placeholder="Create a password (min 6 characters)"
                                />
                            </div>
                            <div class="form-group">
                                <label for="registerPasswordConfirm"
                                    >Confirm Password</label
                                >
                                <input
                                    type="password"
                                    id="registerPasswordConfirm"
                                    name="password_confirmation"
                                    required
                                    placeholder="Confirm your password"
                                />
                            </div>
                            <button type="submit" class="btn" id="registerBtn">
                                <span class="btn-text">Create Account</span>
                            </button>
                        </form>
                    </div>
                </div>

                <!-- App Section -->
                <div class="app-section" id="appSection">
                    <!-- User Info -->
                    <div class="user-info">
                        <div class="user-details">
                            <h3>Welcome, <span id="userName"></span>! 👋</h3>
                            <p id="userEmail"></p>
                        </div>
                        <button
                            class="btn btn-small btn-secondary"
                            id="logoutBtn"
                        >
                            Logout
                        </button>
                    </div>

                    <!-- Upload Section -->
                    <div class="upload-section">
                        <h2>Upload Files</h2>
                        <p>
                            Supported formats: JPG, PNG, GIF, SVG, TXT, MD, CSV
                            • Maximum size: 2MB
                        </p>
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">📁</div>
                            <div
                                style="
                                    font-size: 1.25rem;
                                    color: #334155;
                                    margin-bottom: 1rem;
                                    font-weight: 600;
                                "
                            >
                                Drag & drop files here
                            </div>
                            <div
                                style="
                                    font-size: 1rem;
                                    color: #64748b;
                                    margin-bottom: 2rem;
                                "
                            >
                                or
                            </div>
                            <button
                                type="button"
                                class="btn"
                                onclick="document.getElementById('fileInput').click()"
                            >
                                Choose Files
                            </button>
                            <div
                                class="progress-bar hidden"
                                id="uploadProgress"
                                style="
                                    width: 100%;
                                    height: 8px;
                                    background: #e2e8f0;
                                    border-radius: 0.5rem;
                                    overflow: hidden;
                                    margin-top: 1rem;
                                "
                            >
                                <div
                                    id="uploadProgressFill"
                                    style="
                                        height: 100%;
                                        background: linear-gradient(
                                            90deg,
                                            #0088ff,
                                            #d946ef
                                        );
                                        transition: width 0.3s ease;
                                        width: 0%;
                                    "
                                ></div>
                            </div>
                        </div>
                        <input
                            type="file"
                            id="fileInput"
                            style="display: none"
                            multiple
                            accept=".jpg,.jpeg,.png,.gif,.svg,.txt,.md,.csv,image/*,text/*"
                        />
                    </div>

                    <!-- Stats Section -->
                    <div class="stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="totalFiles">0</div>
                                <div
                                    style="
                                        font-size: 0.875rem;
                                        opacity: 0.9;
                                        text-transform: uppercase;
                                        letter-spacing: 0.05em;
                                        font-weight: 600;
                                    "
                                >
                                    Files
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalSize">0 B</div>
                                <div
                                    style="
                                        font-size: 0.875rem;
                                        opacity: 0.9;
                                        text-transform: uppercase;
                                        letter-spacing: 0.05em;
                                        font-weight: 600;
                                    "
                                >
                                    Storage Used
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="imageFiles">0</div>
                                <div
                                    style="
                                        font-size: 0.875rem;
                                        opacity: 0.9;
                                        text-transform: uppercase;
                                        letter-spacing: 0.05em;
                                        font-weight: 600;
                                    "
                                >
                                    Images
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="documentFiles">
                                    0
                                </div>
                                <div
                                    style="
                                        font-size: 0.875rem;
                                        opacity: 0.9;
                                        text-transform: uppercase;
                                        letter-spacing: 0.05em;
                                        font-weight: 600;
                                    "
                                >
                                    Documents
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Files Section -->
                    <div class="files-section">
                        <h2
                            style="
                                margin-bottom: 2rem;
                                color: #0f172a;
                                font-size: 2rem;
                                font-weight: 700;
                                text-align: center;
                            "
                        >
                            Your Files
                        </h2>
                        <div
                            id="loadingFiles"
                            class="hidden"
                            style="
                                text-align: center;
                                padding: 4rem 2rem;
                                color: #64748b;
                            "
                        >
                            <div
                                style="
                                    display: inline-block;
                                    width: 48px;
                                    height: 48px;
                                    border: 4px solid #e2e8f0;
                                    border-top: 4px solid #0088ff;
                                    border-radius: 50%;
                                    animation: spin 1s linear infinite;
                                    margin-bottom: 1rem;
                                "
                            ></div>
                            <p>Loading your files...</p>
                        </div>
                        <div class="files-grid" id="filesGrid">
                            <div class="empty-state">
                                <div
                                    style="
                                        font-size: 5rem;
                                        margin-bottom: 1.5rem;
                                        opacity: 0.6;
                                    "
                                >
                                    📂
                                </div>
                                <h3
                                    style="
                                        font-size: 1.5rem;
                                        margin-bottom: 0.75rem;
                                        color: #334155;
                                        font-weight: 600;
                                    "
                                >
                                    No files yet
                                </h3>
                                <p style="font-size: 1rem">
                                    Upload your first file to get started!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="alerts-container" id="alertsContainer"></div>

        <script>
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }

            class FileNest {
                constructor() {
                    this.token = localStorage.getItem("filenest_token");
                    this.user = JSON.parse(localStorage.getItem("filenest_user") || "null");
                    this.baseUrl = window.location.origin;
                    this.uploadInProgress = false;
                    this.init();
                }

                init() {
                    this.bindEvents();
                    this.checkAuth();
                }

                bindEvents() {
                    document.querySelectorAll(".auth-tab").forEach(tab => {
                        tab.addEventListener("click", (e) => this.switchAuthTab(e.target.dataset.tab));
                    });

                    document.getElementById("loginFormElement").addEventListener("submit", (e) => this.handleLogin(e));
                    document.getElementById("registerFormElement").addEventListener("submit", (e) => this.handleRegister(e));
                    document.getElementById("logoutBtn").addEventListener("click", () => this.logout());

                    const uploadArea = document.getElementById("uploadArea");
                    const fileInput = document.getElementById("fileInput");

                    uploadArea.addEventListener("dragover", this.handleDragOver.bind(this));
                    uploadArea.addEventListener("dragleave", this.handleDragLeave.bind(this));
                    uploadArea.addEventListener("drop", (e) => this.handleDrop(e));
                    fileInput.addEventListener("change", (e) => this.handleFileSelect(e));

                    document.getElementById("registerPasswordConfirm").addEventListener("input", this.validatePasswordMatch.bind(this));
                }

                switchAuthTab(tab) {
                    const indicator = document.getElementById("tabIndicator");

                    document.querySelectorAll(".auth-tab").forEach(t => t.classList.remove("active"));
                    document.querySelector(`[data-tab="${tab}"]`).classList.add("active");

                    if (tab === "register") {
                        indicator.classList.add("register");
                    } else {
                        indicator.classList.remove("register");
                    }

                    document.querySelectorAll(".auth-form").forEach(f => f.classList.remove("active"));
                    document.getElementById(`${tab}Form`).classList.add("active");
                }

                validatePasswordMatch() {
                    const password = document.getElementById("registerPassword").value;
                    const confirmPassword = document.getElementById("registerPasswordConfirm").value;
                    const confirmField = document.getElementById("registerPasswordConfirm");

                    if (confirmPassword && password !== confirmPassword) {
                        confirmField.setCustomValidity("Passwords do not match");
                    } else {
                        confirmField.setCustomValidity("");
                    }
                }



                async handleLogin(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData);

                    try {
                        this.setButtonLoading("loginBtn", true);
                        const response = await this.apiCall("/auth/login", "POST", data);

                        if (response.token) {
                            this.setAuth(response.token, response.user);
                            this.showAlert("Welcome back! Login successful.", "success");
                            this.showApp();
                            this.loadFiles();
                            e.target.reset();
                        } else {
                            this.showAlert(response.message || "Login failed", "error");
                        }
                    } catch (error) {
                        this.showAlert(error.message || "Login failed. Please try again.", "error");
                    } finally {
                        this.setButtonLoading("loginBtn", false);
                    }
                }

                async handleRegister(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData);

                    if (data.password !== data.password_confirmation) {
                        this.showAlert("Passwords do not match", "error");
                        return;
                    }

                    try {
                        this.setButtonLoading("registerBtn", true);
                        const response = await this.apiCall("/auth/register", "POST", data);

                        if (response.token) {
                            this.setAuth(response.token, response.user);
                            this.showAlert("Registration successful! Welcome to FileNest.", "success");
                            this.showApp();
                            this.loadFiles();
                            e.target.reset();
                        } else {
                            this.showAlert(response.message || "Registration failed", "error");
                        }
                    } catch (error) {
                        this.showAlert(error.message || "Registration failed. Please try again.", "error");
                    } finally {
                        this.setButtonLoading("registerBtn", false);
                    }
                }

                validatePasswordMatch() {
                    const password = document.getElementById("registerPassword").value;
                    const confirmPassword = document.getElementById("registerPasswordConfirm").value;
                    const confirmInput = document.getElementById("registerPasswordConfirm");

                    if (confirmPassword && password !== confirmPassword) {
                        confirmInput.setCustomValidity("Passwords do not match");
                    } else {
                        confirmInput.setCustomValidity("");
                    }
                }

                checkAuth() {
                    if (this.token && this.user) {
                        this.showApp();
                        this.loadFiles();
                    } else {
                        this.showAuth();
                    }
                }

                setAuth(token, user) {
                    this.token = token;
                    this.user = user;
                    localStorage.setItem("filenest_token", token);
                    localStorage.setItem("filenest_user", JSON.stringify(user));
                }

                clearAuth() {
                    this.token = null;
                    this.user = null;
                    localStorage.removeItem("filenest_token");
                    localStorage.removeItem("filenest_user");
                }

                logout() {
                    this.clearAuth();
                    this.showAuth();
                    this.showAlert("Logged out successfully", "success");
                }

                showAuth() {
                    document.getElementById("authSection").style.display = "block";
                    document.getElementById("appSection").classList.remove("active");
                }

                showApp() {
                    document.getElementById("authSection").style.display = "none";
                    document.getElementById("appSection").classList.add("active");
                    document.getElementById("userName").textContent = this.user?.name || "User";
                    document.getElementById("userEmail").textContent = this.user?.email || "";
                }

                async apiCall(endpoint, method = "GET", data = null, isFormData = false) {
                    const url = `${this.baseUrl}${endpoint}`;
                    const options = {
                        method,
                        headers: {}
                    };

                    if (this.token) {
                        options.headers["Authorization"] = `Bearer ${this.token}`;
                    }

                    if (data) {
                        if (isFormData) {
                            options.body = data;
                        } else {
                            options.headers["Content-Type"] = "application/json";
                            options.body = JSON.stringify(data);
                        }
                    }

                    const response = await fetch(url, options);

                    if (response.status === 401) {
                        this.clearAuth();
                        this.showAuth();
                        throw new Error("Session expired. Please login again.");
                    }

                    const responseData = await response.json();

                    if (!response.ok) {
                        throw new Error(responseData.message || `HTTP ${response.status}`);
                    }

                    return responseData;
                }

                handleDragOver(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    document.getElementById("uploadArea").classList.add("drag-over");
                }

                handleDragLeave(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (!e.currentTarget.contains(e.relatedTarget)) {
                        document.getElementById("uploadArea").classList.remove("drag-over");
                    }
                }

                async handleDrop(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    document.getElementById("uploadArea").classList.remove("drag-over");

                    const files = Array.from(e.dataTransfer.files);
                    if (files.length > 0) {
                        await this.uploadFiles(files);
                    }
                }

                async handleFileSelect(e) {
                    const files = Array.from(e.target.files);
                    if (files.length > 0) {
                        await this.uploadFiles(files);
                        e.target.value = "";
                    }
                }

                async uploadFiles(files) {
                    if (this.uploadInProgress) return;

                    this.uploadInProgress = true;
                    const uploadProgress = document.getElementById("uploadProgress");
                    const progressBar = document.getElementById("progressBar");
                    const progressText = document.getElementById("progressText");

                    uploadProgress.style.display = "block";

                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const progress = ((i + 1) / files.length) * 100;

                        progressBar.style.width = `${progress}%`;
                        progressText.textContent = `Uploading ${file.name}... (${i + 1}/${files.length})`;

                        try {
                            await this.uploadFile(file);
                            this.showAlert(`${file.name} uploaded successfully!`, "success");
                        } catch (error) {
                            this.showAlert(`Failed to upload ${file.name}: ${error.message}`, "error");
                        }
                    }

                    uploadProgress.style.display = "none";
                    this.uploadInProgress = false;
                    await this.loadFiles();
                }

                async uploadFile(file) {
                    const formData = new FormData();
                    formData.append("file", file);

                    return await this.apiCall("/upload", "POST", formData, true);
                }

                async loadFiles() {
                    try {
                        const response = await this.apiCall("/files");
                        this.renderFiles(response.files || []);
                        this.updateStats(response.stats || {});
                    } catch (error) {
                        this.showAlert("Failed to load files: " + error.message, "error");
                    }
                }

                renderFiles(files) {
                    const container = document.getElementById("filesGrid");

                    if (files.length === 0) {
                        container.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">📁</div>
                                <h3>No files yet</h3>
                                <p>Upload your first file to get started</p>
                            </div>
                        `;
                        return;
                    }

                    container.innerHTML = files.map(file => `
                        <div class="file-card" data-file-id="${file.id}">
                            <div class="file-icon">
                                ${this.getFileIcon(file.content_type, file.is_image)}
                            </div>
                            <div class="file-info">
                                <div class="file-name" title="${file.filename}">${file.filename}</div>
                                <div class="file-meta">
                                    <span class="file-size">${file.human_readable_size}</span>
                                    <span class="file-date">${new Date(file.uploaded_at).toLocaleDateString()}</span>
                                </div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn download-btn" onclick="app.downloadFile(${file.id})" title="Download">
                                    📥
                                </button>
                                <button class="action-btn delete-btn" onclick="app.deleteFile(${file.id})" title="Delete">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    `).join("");
                }

                getFileIcon(contentType, isImage) {
                    if (isImage) return "🖼️";
                    if (contentType?.includes("text")) return "📄";
                    if (contentType?.includes("csv")) return "📊";
                    return "📎";
                }

                updateStats(stats) {
                    document.getElementById("totalFiles").textContent = stats.total_files || 0;
                    document.getElementById("totalSize").textContent = stats.total_size || "0 B";
                }

                async downloadFile(fileId) {
                    try {
                        const url = `${this.baseUrl}/files/${fileId}/download`;
                        const response = await fetch(url, {
                            headers: {
                                "Authorization": `Bearer ${this.token}`
                            }
                        });

                        if (!response.ok) {
                            throw new Error("Download failed");
                        }

                        const blob = await response.blob();
                        const contentDisposition = response.headers.get('Content-Disposition');
                        let filename = `file_${fileId}`;

                        if (contentDisposition) {
                            const filenameMatch = contentDisposition.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);
                            if (filenameMatch) {
                                filename = filenameMatch[1].replace(/['"]/g, '');
                            }
                        }

                        const downloadUrl = window.URL.createObjectURL(blob);
                        const a = document.createElement("a");
                        a.href = downloadUrl;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(downloadUrl);

                        this.showAlert("File downloaded successfully!", "success");
                    } catch (error) {
                        this.showAlert("Download failed: " + error.message, "error");
                    }
                }

                async deleteFile(fileId) {
                    if (!confirm("Are you sure you want to delete this file? This action cannot be undone.")) {
                        return;
                    }

                    try {
                        await this.apiCall(`/files/${fileId}`, "DELETE");
                        this.showAlert("File deleted successfully!", "success");
                        await this.loadFiles();
                    } catch (error) {
                        this.showAlert("Delete failed: " + error.message, "error");
                    }
                }

                showAlert(message, type = "info") {
                    const alertContainer = document.getElementById("alertsContainer");
                    const alert = document.createElement("div");
                    alert.className = `alert alert-${type}`;
                    alert.innerHTML = `
                        <span>${message}</span>
                        <button class="alert-close" onclick="this.parentElement.remove()">×</button>
                    `;

                    alertContainer.appendChild(alert);

                    setTimeout(() => {
                        if (alert.parentElement) {
                            alert.remove();
                        }
                    }, 5000);
                }

                setButtonLoading(buttonId, loading) {
                    const button = document.getElementById(buttonId);
                    if (loading) {
                        button.disabled = true;
                        button.dataset.originalText = button.textContent;
                        button.innerHTML = '<div class="spinner"></div> Loading...';
                    } else {
                        button.disabled = false;
                        button.textContent = button.dataset.originalText;
                    }
                }
            }

            // Initialize the application
            const app = new FileNest();
        </script>
    </body>
</html>
