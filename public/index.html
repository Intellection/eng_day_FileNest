<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>SnapVault - Your Personal File Cache</title>
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üóÑÔ∏è</text></svg>"
        />
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            :root {
                --primary-color: #667eea;
                --primary-dark: #5a67d8;
                --secondary-color: #764ba2;
                --success-color: #48bb78;
                --error-color: #f56565;
                --warning-color: #ed8936;
                --info-color: #4299e1;
                --gray-50: #f7fafc;
                --gray-100: #edf2f7;
                --gray-200: #e2e8f0;
                --gray-300: #cbd5e0;
                --gray-400: #a0aec0;
                --gray-500: #718096;
                --gray-600: #4a5568;
                --gray-700: #2d3748;
                --gray-800: #1a202c;
                --gray-900: #171923;
                --white: #ffffff;
                --border-radius: 8px;
                --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
                --shadow:
                    0 1px 3px 0 rgba(0, 0, 0, 0.1),
                    0 1px 2px 0 rgba(0, 0, 0, 0.06);
                --shadow-md:
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06);
                --shadow-lg:
                    0 10px 15px -3px rgba(0, 0, 0, 0.1),
                    0 4px 6px -2px rgba(0, 0, 0, 0.05);
                --shadow-xl:
                    0 20px 25px -5px rgba(0, 0, 0, 0.1),
                    0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    "Helvetica Neue", Arial, sans-serif;
                background: linear-gradient(
                    135deg,
                    var(--primary-color) 0%,
                    var(--secondary-color) 100%
                );
                min-height: 100vh;
                color: var(--gray-800);
                line-height: 1.6;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 1rem;
            }

            .header {
                text-align: center;
                color: var(--white);
                margin-bottom: 2rem;
                padding: 2rem 0;
            }

            .header h1 {
                font-size: 3.5rem;
                margin-bottom: 0.5rem;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                font-weight: 700;
            }

            .header p {
                font-size: 1.25rem;
                opacity: 0.95;
                max-width: 600px;
                margin: 0 auto;
            }

            .main-content {
                background: var(--white);
                border-radius: 20px;
                box-shadow: var(--shadow-xl);
                overflow: hidden;
                backdrop-filter: blur(10px);
            }

            /* Auth Section */
            .auth-section {
                padding: 3rem;
                background: linear-gradient(
                    135deg,
                    var(--gray-50) 0%,
                    var(--white) 100%
                );
            }

            .auth-tabs {
                display: flex;
                justify-content: center;
                margin-bottom: 2rem;
                background: var(--gray-100);
                border-radius: var(--border-radius);
                padding: 0.25rem;
            }

            .auth-tab {
                flex: 1;
                max-width: 200px;
                padding: 0.75rem 1.5rem;
                background: transparent;
                border: none;
                border-radius: var(--border-radius);
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s ease;
                color: var(--gray-600);
            }

            .auth-tab.active {
                background: var(--white);
                color: var(--primary-color);
                box-shadow: var(--shadow-sm);
            }

            .auth-form {
                max-width: 400px;
                margin: 0 auto;
                display: none;
            }

            .auth-form.active {
                display: block;
            }

            .auth-form h2 {
                text-align: center;
                margin-bottom: 2rem;
                color: var(--gray-800);
                font-size: 1.5rem;
                font-weight: 600;
            }

            .form-group {
                margin-bottom: 1.5rem;
            }

            .form-group label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 600;
                color: var(--gray-700);
                font-size: 0.875rem;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }

            .form-group input {
                width: 100%;
                padding: 0.875rem 1rem;
                border: 2px solid var(--gray-200);
                border-radius: var(--border-radius);
                font-size: 1rem;
                transition: all 0.3s ease;
                background: var(--white);
            }

            .form-group input:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

            .form-group input:invalid {
                border-color: var(--error-color);
            }

            .btn {
                background: linear-gradient(
                    135deg,
                    var(--primary-color) 0%,
                    var(--primary-dark) 100%
                );
                color: var(--white);
                border: none;
                padding: 0.875rem 1.5rem;
                border-radius: var(--border-radius);
                cursor: pointer;
                font-size: 1rem;
                font-weight: 600;
                transition: all 0.3s ease;
                width: 100%;
                position: relative;
                overflow: hidden;
            }

            .btn:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }

            .btn:active {
                transform: translateY(0);
            }

            .btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            .btn-secondary {
                background: var(--gray-600);
            }

            .btn-secondary:hover:not(:disabled) {
                background: var(--gray-700);
            }

            .btn-danger {
                background: var(--error-color);
            }

            .btn-danger:hover:not(:disabled) {
                background: #e53e3e;
            }

            .btn-small {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }

            /* App Section */
            .app-section {
                display: none;
                padding: 2rem;
            }

            .app-section.active {
                display: block;
            }

            .user-info {
                background: linear-gradient(
                    135deg,
                    var(--success-color),
                    #38a169
                );
                color: var(--white);
                padding: 1.5rem;
                border-radius: 12px;
                margin-bottom: 2rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: var(--shadow-md);
            }

            .user-details h3 {
                font-size: 1.25rem;
                margin-bottom: 0.25rem;
            }

            .user-details p {
                opacity: 0.9;
                font-size: 0.875rem;
            }

            /* Upload Section */
            .upload-section {
                background: var(--gray-50);
                padding: 2rem;
                border-radius: 12px;
                margin-bottom: 2rem;
                text-align: center;
            }

            .upload-section h2 {
                margin-bottom: 0.5rem;
                color: var(--gray-800);
            }

            .upload-section p {
                color: var(--gray-600);
                margin-bottom: 1.5rem;
            }

            .upload-area {
                border: 3px dashed var(--gray-300);
                border-radius: 12px;
                padding: 3rem 2rem;
                margin: 1.5rem 0;
                transition: all 0.3s ease;
                cursor: pointer;
                background: var(--white);
                position: relative;
            }

            .upload-area:hover {
                border-color: var(--primary-color);
                background: #f0f8ff;
            }

            .upload-area.dragover {
                border-color: var(--primary-color);
                background: #f0f8ff;
                transform: scale(1.02);
            }

            .upload-icon {
                font-size: 3rem;
                margin-bottom: 1rem;
                color: var(--gray-400);
            }

            .upload-text {
                font-size: 1.125rem;
                color: var(--gray-600);
                margin-bottom: 1rem;
            }

            .upload-subtext {
                font-size: 0.875rem;
                color: var(--gray-500);
                margin-bottom: 1.5rem;
            }

            .file-input {
                display: none;
            }

            /* Stats Section */
            .stats {
                background: linear-gradient(135deg, var(--info-color), #3182ce);
                color: var(--white);
                padding: 1.5rem;
                border-radius: 12px;
                margin-bottom: 2rem;
                box-shadow: var(--shadow-md);
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 1.5rem;
            }

            .stat-item {
                text-align: center;
            }

            .stat-value {
                font-size: 2rem;
                font-weight: 700;
                line-height: 1;
                margin-bottom: 0.25rem;
            }

            .stat-label {
                font-size: 0.875rem;
                opacity: 0.9;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }

            /* Files Section */
            .files-section h2 {
                margin-bottom: 1.5rem;
                color: var(--gray-800);
                font-size: 1.5rem;
            }

            .files-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: 1.5rem;
            }

            .file-card {
                background: var(--white);
                border: 1px solid var(--gray-200);
                border-radius: 12px;
                padding: 1.5rem;
                box-shadow: var(--shadow);
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .file-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-lg);
                border-color: var(--primary-color);
            }

            .file-info {
                display: flex;
                align-items: flex-start;
                margin-bottom: 1rem;
            }

            .file-icon {
                width: 48px;
                height: 48px;
                background: linear-gradient(
                    135deg,
                    var(--primary-color),
                    var(--primary-dark)
                );
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--white);
                font-size: 1.5rem;
                margin-right: 1rem;
                flex-shrink: 0;
            }

            .file-details {
                flex: 1;
                min-width: 0;
            }

            .file-details h3 {
                margin: 0 0 0.5rem 0;
                font-size: 1rem;
                font-weight: 600;
                color: var(--gray-800);
                word-break: break-all;
                line-height: 1.4;
            }

            .file-meta {
                display: flex;
                flex-wrap: wrap;
                gap: 0.75rem;
                font-size: 0.75rem;
                color: var(--gray-500);
            }

            .file-meta span {
                background: var(--gray-100);
                padding: 0.25rem 0.5rem;
                border-radius: 4px;
                font-weight: 500;
            }

            .file-actions {
                display: flex;
                gap: 0.5rem;
            }

            .file-actions .btn {
                flex: 1;
            }

            /* Alerts */
            .alerts-container {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                max-width: 400px;
            }

            .alert {
                padding: 1rem 1.25rem;
                border-radius: var(--border-radius);
                margin-bottom: 0.75rem;
                font-weight: 500;
                box-shadow: var(--shadow-lg);
                animation: slideIn 0.3s ease;
                position: relative;
                padding-right: 3rem;
            }

            .alert-success {
                background: #f0fff4;
                color: #22543d;
                border-left: 4px solid var(--success-color);
            }

            .alert-error {
                background: #fff5f5;
                color: #742a2a;
                border-left: 4px solid var(--error-color);
            }

            .alert-close {
                position: absolute;
                top: 0.75rem;
                right: 1rem;
                background: none;
                border: none;
                font-size: 1.25rem;
                cursor: pointer;
                color: inherit;
                opacity: 0.5;
            }

            .alert-close:hover {
                opacity: 1;
            }

            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            /* Loading */
            .loading {
                text-align: center;
                padding: 3rem;
                color: var(--gray-500);
            }

            .spinner {
                display: inline-block;
                width: 40px;
                height: 40px;
                border: 4px solid var(--gray-200);
                border-top: 4px solid var(--primary-color);
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-bottom: 1rem;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .hidden {
                display: none !important;
            }

            .empty-state {
                text-align: center;
                padding: 3rem;
                color: var(--gray-500);
                grid-column: 1 / -1;
            }

            .empty-state-icon {
                font-size: 4rem;
                margin-bottom: 1rem;
                opacity: 0.5;
            }

            .empty-state h3 {
                font-size: 1.25rem;
                margin-bottom: 0.5rem;
                color: var(--gray-600);
            }

            .empty-state p {
                font-size: 0.875rem;
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .container {
                    padding: 0.5rem;
                }

                .header h1 {
                    font-size: 2.5rem;
                }

                .header p {
                    font-size: 1rem;
                }

                .auth-section {
                    padding: 2rem 1.5rem;
                }

                .app-section {
                    padding: 1.5rem;
                }

                .upload-section {
                    padding: 1.5rem;
                }

                .upload-area {
                    padding: 2rem 1rem;
                }

                .files-grid {
                    grid-template-columns: 1fr;
                }

                .user-info {
                    flex-direction: column;
                    gap: 1rem;
                    text-align: center;
                }

                .file-actions {
                    flex-direction: column;
                }

                .stats-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
            }

            @media (max-width: 480px) {
                .auth-tabs {
                    flex-direction: column;
                    gap: 0.25rem;
                }

                .auth-tab {
                    max-width: none;
                }

                .file-info {
                    flex-direction: column;
                    align-items: center;
                    text-align: center;
                }

                .file-icon {
                    margin-right: 0;
                    margin-bottom: 1rem;
                }
            }

            /* Progress Bar */
            .progress-bar {
                width: 100%;
                height: 4px;
                background: var(--gray-200);
                border-radius: 2px;
                overflow: hidden;
                margin-top: 1rem;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(
                    90deg,
                    var(--primary-color),
                    var(--primary-dark)
                );
                border-radius: 2px;
                transition: width 0.3s ease;
                width: 0%;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>üóÑÔ∏è SnapVault</h1>
                <p>Your Personal File Cache - Secure, Simple, Fast</p>
            </div>

            <div class="main-content">
                <!-- Authentication Section -->
                <div class="auth-section" id="authSection">
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="login">
                            Login
                        </button>
                        <button class="auth-tab" data-tab="register">
                            Register
                        </button>
                    </div>

                    <!-- Login Form -->
                    <div class="auth-form active" id="loginForm">
                        <h2>Welcome Back</h2>
                        <form id="loginFormElement">
                            <div class="form-group">
                                <label for="loginEmail">Email Address</label>
                                <input
                                    type="email"
                                    id="loginEmail"
                                    name="email"
                                    required
                                    placeholder="Enter your email"
                                />
                            </div>
                            <div class="form-group">
                                <label for="loginPassword">Password</label>
                                <input
                                    type="password"
                                    id="loginPassword"
                                    name="password"
                                    required
                                    placeholder="Enter your password"
                                />
                            </div>
                            <button type="submit" class="btn" id="loginBtn">
                                <span class="btn-text">Login</span>
                            </button>
                        </form>
                    </div>

                    <!-- Register Form -->
                    <div class="auth-form" id="registerForm">
                        <h2>Create Account</h2>
                        <form id="registerFormElement">
                            <div class="form-group">
                                <label for="registerName">Full Name</label>
                                <input
                                    type="text"
                                    id="registerName"
                                    name="name"
                                    required
                                    placeholder="Enter your full name"
                                />
                            </div>
                            <div class="form-group">
                                <label for="registerEmail">Email Address</label>
                                <input
                                    type="email"
                                    id="registerEmail"
                                    name="email"
                                    required
                                    placeholder="Enter your email"
                                />
                            </div>
                            <div class="form-group">
                                <label for="registerPassword">Password</label>
                                <input
                                    type="password"
                                    id="registerPassword"
                                    name="password"
                                    required
                                    minlength="6"
                                    placeholder="Create a password (min 6 characters)"
                                />
                            </div>
                            <div class="form-group">
                                <label for="registerPasswordConfirm"
                                    >Confirm Password</label
                                >
                                <input
                                    type="password"
                                    id="registerPasswordConfirm"
                                    name="password_confirmation"
                                    required
                                    placeholder="Confirm your password"
                                />
                            </div>
                            <button type="submit" class="btn" id="registerBtn">
                                <span class="btn-text">Create Account</span>
                            </button>
                        </form>
                    </div>
                </div>

                <!-- App Section -->
                <div class="app-section" id="appSection">
                    <!-- User Info -->
                    <div class="user-info">
                        <div class="user-details">
                            <h3>Welcome, <span id="userName"></span>! üëã</h3>
                            <p id="userEmail"></p>
                        </div>
                        <button
                            class="btn btn-small btn-secondary"
                            id="logoutBtn"
                        >
                            Logout
                        </button>
                    </div>

                    <!-- Upload Section -->
                    <div class="upload-section">
                        <h2>Upload Files</h2>
                        <p>
                            Supported formats: JPG, PNG, GIF, SVG, TXT, MD, CSV
                            ‚Ä¢ Maximum size: 2MB
                        </p>

                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">üìÅ</div>
                            <div class="upload-text">
                                Drag & drop files here
                            </div>
                            <div class="upload-subtext">or</div>
                            <button
                                type="button"
                                class="btn"
                                onclick="document.getElementById('fileInput').click()"
                            >
                                Choose Files
                            </button>
                            <div
                                class="progress-bar hidden"
                                id="uploadProgress"
                            >
                                <div
                                    class="progress-fill"
                                    id="uploadProgressFill"
                                ></div>
                            </div>
                        </div>

                        <input
                            type="file"
                            id="fileInput"
                            class="file-input"
                            multiple
                            accept=".jpg,.jpeg,.png,.gif,.svg,.txt,.md,.csv,image/*,text/*"
                        />
                    </div>

                    <!-- Stats Section -->
                    <div class="stats" id="statsSection">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="totalFiles">0</div>
                                <div class="stat-label">Files</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalSize">0 B</div>
                                <div class="stat-label">Storage Used</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="imageFiles">0</div>
                                <div class="stat-label">Images</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="documentFiles">
                                    0
                                </div>
                                <div class="stat-label">Documents</div>
                            </div>
                        </div>
                    </div>

                    <!-- Files Section -->
                    <div class="files-section">
                        <h2>Your Files</h2>
                        <div id="loadingFiles" class="loading hidden">
                            <div class="spinner"></div>
                            <p>Loading your files...</p>
                        </div>
                        <div class="files-grid" id="filesGrid">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìÇ</div>
                                <h3>No files yet</h3>
                                <p>Upload your first file to get started!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Container -->
        <div class="alerts-container" id="alertsContainer"></div>

        <script>
            class SnapVault {
                constructor() {
                    this.token = localStorage.getItem("snapvault_token");
                    this.user = JSON.parse(
                        localStorage.getItem("snapvault_user") || "null",
                    );
                    this.baseUrl = window.location.origin;
                    this.uploadInProgress = false;

                    this.init();
                }

                init() {
                    this.bindEvents();
                    this.checkAuth();
                }

                bindEvents() {
                    // Auth tabs
                    document.querySelectorAll(".auth-tab").forEach((tab) => {
                        tab.addEventListener("click", (e) =>
                            this.switchAuthTab(e.target.dataset.tab),
                        );
                    });

                    // Auth forms
                    document
                        .getElementById("loginFormElement")
                        .addEventListener("submit", (e) => this.handleLogin(e));
                    document
                        .getElementById("registerFormElement")
                        .addEventListener("submit", (e) =>
                            this.handleRegister(e),
                        );
                    document
                        .getElementById("logoutBtn")
                        .addEventListener("click", () => this.logout());

                    // File upload
                    const uploadArea = document.getElementById("uploadArea");
                    const fileInput = document.getElementById("fileInput");

                    uploadArea.addEventListener(
                        "dragover",
                        this.handleDragOver.bind(this),
                    );
                    uploadArea.addEventListener(
                        "dragleave",
                        this.handleDragLeave.bind(this),
                    );
                    uploadArea.addEventListener("drop", (e) =>
                        this.handleDrop(e),
                    );
                    fileInput.addEventListener("change", (e) =>
                        this.handleFileSelect(e),
                    );

                    // Password confirmation validation
                    document
                        .getElementById("registerPasswordConfirm")
                        .addEventListener(
                            "input",
                            this.validatePasswordMatch.bind(this),
                        );
                }

                switchAuthTab(tab) {
                    // Update tab buttons
                    document
                        .querySelectorAll(".auth-tab")
                        .forEach((t) => t.classList.remove("active"));
                    document
                        .querySelector(`[data-tab="${tab}"]`)
                        .classList.add("active");

                    // Update forms
                    document
                        .querySelectorAll(".auth-form")
                        .forEach((f) => f.classList.remove("active"));
                    document
                        .getElementById(`${tab}Form`)
                        .classList.add("active");
                }

                validatePasswordMatch() {
                    const password =
                        document.getElementById("registerPassword").value;
                    const confirmPassword = document.getElementById(
                        "registerPasswordConfirm",
                    ).value;
                    const confirmField = document.getElementById(
                        "registerPasswordConfirm",
                    );

                    if (confirmPassword && password !== confirmPassword) {
                        confirmField.setCustomValidity(
                            "Passwords do not match",
                        );
                    } else {
                        confirmField.setCustomValidity("");
                    }
                }

                checkAuth() {
                    if (this.token && this.user) {
                        this.showApp();
                        this.loadFiles();
                    } else {
                        this.showAuth();
                    }
                }

                showAuth() {
                    document.getElementById("authSection").style.display =
                        "block";
                    document
                        .getElementById("appSection")
                        .classList.remove("active");
                }

                showApp() {
                    document.getElementById("authSection").style.display =
                        "none";
                    document
                        .getElementById("appSection")
                        .classList.add("active");
                    document.getElementById("userName").textContent =
                        this.user.name;
                    document.getElementById("userEmail").textContent =
                        this.user.email;
                }

                async handleLogin(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData);

                    try {
                        this.setButtonLoading("loginBtn", true);
                        const response = await this.apiCall(
                            "/auth/login",
                            "POST",
                            data,
                        );

                        if (response.token) {
                            this.setAuth(response.token, response.user);
                            this.showAlert(
                                "Welcome back! Login successful.",
                                "success",
                            );
                            this.showApp();
                            this.loadFiles();
                            e.target.reset();
                        } else {
                            this.showAlert(
                                response.message || "Login failed",
                                "error",
                            );
                        }
                    } catch (error) {
                        this.showAlert(
                            error.message || "Login failed. Please try again.",
                            "error",
                        );
                    } finally {
                        this.setButtonLoading("loginBtn", false);
                    }
                }

                async handleRegister(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData);

                    if (data.password !== data.password_confirmation) {
                        this.showAlert("Passwords do not match", "error");
                        return;
                    }

                    try {
                        this.setButtonLoading("registerBtn", true);
                        const response = await this.apiCall(
                            "/auth/register",
                            "POST",
                            data,
                        );

                        if (response.token) {
                            this.setAuth(response.token, response.user);
                            this.showAlert(
                                "Account created successfully! Welcome to SnapVault.",
                                "success",
                            );
                            this.showApp();
                            this.loadFiles();
                            e.target.reset();
                        } else {
                            this.showAlert(
                                response.message || "Registration failed",
                                "error",
                            );
                            if (response.errors) {
                                response.errors.forEach((error) =>
                                    this.showAlert(error, "error"),
                                );
                            }
                        }
                    } catch (error) {
                        this.showAlert(
                            error.message ||
                                "Registration failed. Please try again.",
                            "error",
                        );
                    } finally {
                        this.setButtonLoading("registerBtn", false);
                    }
                }

                logout() {
                    localStorage.removeItem("snapvault_token");
                    localStorage.removeItem("snapvault_user");
                    this.token = null;
                    this.user = null;
                    this.showAuth();
                    this.showAlert(
                        "You have been logged out successfully",
                        "success",
                    );
                }

                setAuth(token, user) {
                    this.token = token;
                    this.user = user;
                    localStorage.setItem("snapvault_token", token);
                    localStorage.setItem(
                        "snapvault_user",
                        JSON.stringify(user),
                    );
                }

                handleDragOver(e) {
                    e.preventDefault();
                    e.currentTarget.classList.add("dragover");
                }

                handleDragLeave(e) {
                    e.preventDefault();
                    e.currentTarget.classList.remove("dragover");
                }

                handleDrop(e) {
                    e.preventDefault();
                    e.currentTarget.classList.remove("dragover");
                    const files = Array.from(e.dataTransfer.files);
                    this.uploadFiles(files);
                }

                handleFileSelect(e) {
                    const files = Array.from(e.target.files);
                    this.uploadFiles(files);
                    e.target.value = ""; // Reset input
                }

                async uploadFiles(files) {
                    if (this.uploadInProgress) {
                        this.showAlert(
                            "Upload already in progress. Please wait.",
                            "error",
                        );
                        return;
                    }

                    if (files.length === 0) return;

                    this.uploadInProgress = true;
                    const progressBar =
                        document.getElementById("uploadProgress");
                    const progressFill =
                        document.getElementById("uploadProgressFill");

                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];

                        progressBar.classList.remove("hidden");
                        const progress = ((i + 1) / files.length) * 100;
                        progressFill.style.width = `${progress}%`;

                        await this.uploadFile(file);
                    }

                    progressBar.classList.add("hidden");
                    this.uploadInProgress = false;
                    this.loadFiles(); // Refresh the files list
                }

                async uploadFile(file) {
                    const formData = new FormData();
                    formData.append("file", file);

                    try {
                        const response = await this.apiCall(
                            "/upload",
                            "POST",
                            formData,
                            true,
                        );
                        this.showAlert(
                            `‚úÖ ${file.name} uploaded successfully!`,
                            "success",
                        );
                    } catch (error) {
                        this.showAlert(
                            `‚ùå Failed to upload ${file.name}: ${error.message}`,
                            "error",
                        );
                    }
                }

                async loadFiles() {
                    try {
                        document
                            .getElementById("loadingFiles")
                            .classList.remove("hidden");
                        const response = await this.apiCall("/files", "GET");
                        this.displayFiles(response.files || []);
                        this.updateStats(response);
                    } catch (error) {
                        this.showAlert(
                            "Failed to load files: " + error.message,
                            "error",
                        );
                    } finally {
                        document
                            .getElementById("loadingFiles")
                            .classList.add("hidden");
                    }
                }

                displayFiles(files) {
                    const filesGrid = document.getElementById("filesGrid");

                    if (files.length === 0) {
                        filesGrid.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìÇ</div>
                            <h3>No files yet</h3>
                            <p>Upload your first file to get started!</p>
                        </div>
                    `;
                        return;
                    }

                    filesGrid.innerHTML = files
                        .map(
                            (file) => `
                    <div class="file-card">
                        <div class="file-info">
                            <div class="file-icon">
                                ${this.getFileIcon(file.content_type)}
                            </div>
                            <div class="file-details">
                                <h3 title="${this.escapeHtml(file.filename)}">${this.escapeHtml(file.filename)}</h3>
                                <div class="file-meta">
                                    <span>${file.human_readable_size}</span>
                                    <span>${new Date(file.uploaded_at).toLocaleDateString()}</span>
                                    <span>${file.content_type.split("/")[1].toUpperCase()}</span>
                                </div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="btn btn-small btn-secondary" onclick="snapVault.downloadFile(${file.id})">
                                üì• Download
                            </button>
                            <button class="btn btn-small btn-danger" onclick="snapVault.deleteFile(${file.id}, '${this.escapeHtml(file.filename)}')">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>
                `,
                        )
                        .join("");
                }

                updateStats(data) {
                    document.getElementById("totalFiles").textContent =
                        data.total_count || 0;
                    document.getElementById("totalSize").textContent =
                        data.human_readable_total_size || "0 B";

                    // Calculate image and document counts
                    const files = data.files || [];
                    const imageCount = files.filter((f) => f.is_image).length;
                    const documentCount = files.filter((f) => f.is_text).length;

                    document.getElementById("imageFiles").textContent =
                        imageCount;
                    document.getElementById("documentFiles").textContent =
                        documentCount;
                }

                getFileIcon(contentType) {
                    if (contentType.startsWith("image/")) {
                        if (contentType.includes("svg")) return "üé®";
                        return "üñºÔ∏è";
                    }
                    if (contentType.includes("text/plain")) return "üìÑ";
                    if (contentType.includes("markdown")) return "üìù";
                    if (contentType.includes("csv")) return "üìä";
                    return "üìÅ";
                }

                async downloadFile(fileId) {
                    try {
                        const response = await fetch(
                            `${this.baseUrl}/files/${fileId}/download`,
                            {
                                method: "GET",
                                headers: {
                                    Authorization: `Bearer ${this.token}`,
                                },
                            },
                        );

                        if (!response.ok) {
                            let errorMsg = "Download failed";
                            try {
                                const error = await response.json();
                                errorMsg = error.message || errorMsg;
                            } catch (e) {}
                            this.showAlert(errorMsg, "error");
                            return;
                        }

                        // Try to extract filename from Content-Disposition header
                        let filename = "";
                        const disposition = response.headers.get(
                            "Content-Disposition",
                        );
                        if (disposition && disposition.includes("filename=")) {
                            filename = disposition
                                .split("filename=")[1]
                                .split(";")[0]
                                .replace(/['"]/g, "")
                                .trim();
                        }

                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement("a");
                        link.href = url;
                        link.download = filename || "";
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        window.URL.revokeObjectURL(url);

                        this.showAlert(
                            "File downloaded successfully",
                            "success",
                        );
                    } catch (error) {
                        this.showAlert("Failed to download file", "error");
                    }
                }

                async deleteFile(fileId, filename) {
                    if (
                        !confirm(
                            `Are you sure you want to delete "${filename}"?\n\nThis action cannot be undone.`,
                        )
                    ) {
                        return;
                    }

                    try {
                        await this.apiCall(`/files/${fileId}`, "DELETE");
                        this.showAlert(
                            `üóëÔ∏è "${filename}" deleted successfully`,
                            "success",
                        );
                        this.loadFiles();
                    } catch (error) {
                        this.showAlert(
                            "Failed to delete file: " + error.message,
                            "error",
                        );
                    }
                }

                async apiCall(
                    endpoint,
                    method = "GET",
                    data = null,
                    isFormData = false,
                ) {
                    const url = `${this.baseUrl}${endpoint}`;
                    const options = {
                        method,
                        headers: {},
                    };

                    if (this.token) {
                        options.headers["Authorization"] =
                            `Bearer ${this.token}`;
                    }

                    if (data) {
                        if (isFormData) {
                            options.body = data;
                        } else {
                            options.headers["Content-Type"] =
                                "application/json";
                            options.body = JSON.stringify(data);
                        }
                    }

                    const response = await fetch(url, options);

                    if (!response.ok) {
                        let errorMessage = `HTTP ${response.status}`;
                        try {
                            const errorData = await response.json();
                            errorMessage = errorData.message || errorMessage;
                        } catch (e) {
                            // Use default error message if response is not JSON
                        }
                        throw new Error(errorMessage);
                    }

                    return await response.json();
                }

                showAlert(message, type = "info") {
                    const alertsContainer =
                        document.getElementById("alertsContainer");
                    const alert = document.createElement("div");
                    alert.className = `alert alert-${type === "error" ? "error" : "success"}`;

                    alert.innerHTML = `
                    ${message}
                    <button class="alert-close" onclick="this.parentElement.remove()">√ó</button>
                `;

                    alertsContainer.appendChild(alert);

                    // Auto-remove after 5 seconds
                    setTimeout(() => {
                        if (alert.parentElement) {
                            alert.remove();
                        }
                    }, 5000);
                }

                setButtonLoading(buttonId, loading) {
                    const button = document.getElementById(buttonId);
                    const btnText = button.querySelector(".btn-text");

                    if (loading) {
                        button.disabled = true;
                        btnText.textContent = "Loading...";
                    } else {
                        button.disabled = false;
                        if (buttonId === "loginBtn") {
                            btnText.textContent = "Login";
                        } else if (buttonId === "registerBtn") {
                            btnText.textContent = "Create Account";
                        }
                    }
                }

                escapeHtml(text) {
                    const div = document.createElement("div");
                    div.textContent = text;
                    return div.innerHTML;
                }
            }

            // Initialize the app when DOM is loaded
            document.addEventListener("DOMContentLoaded", function () {
                window.snapVault = new SnapVault();
            });

            // Handle browser back/forward
            window.addEventListener("popstate", function () {
                if (window.snapVault) {
                    window.snapVault.checkAuth();
                }
            });
        </script>
    </body>
</html>
